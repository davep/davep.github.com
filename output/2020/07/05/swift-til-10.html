<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>"Swift TIL 10"</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="blog.davep.org Atom Feed" />
        <meta name="description" content="My leisurely journey into getting to know Swift by reading and then making notes to myself in my blog continues, and this weekend I encountered..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">blog.davep.org</a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/07/05/swift-til-10.html" rel="bookmark"
           title="Permalink to "Swift TIL 10"">"Swift TIL 10"</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-07-05T15:27:00+01:00">
                Published: Sun 05 July 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/dave-pearson.html">Dave Pearson</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/swift.html">[ &#34;swift&#34;</a> <a href="/tag/apple.html">&#34;apple&#34;</a> <a href="/tag/til.html">&#34;TIL&#34; ]</a> </p>
</footer><!-- /.post-info -->      <p>My leisurely journey into getting to know Swift by reading and then making
notes to myself in my blog continues, and this weekend I encountered
<code>defer</code>. As I was reading about Swift I did keep wondering when something
like <code>try</code> (it has <code>try</code>), <code>catch</code> (it has <code>catch</code>) and <code>finally</code> (it
doesn't have <code>finally</code>, but...) might crop up. This weekend I hit the part
of the book that covered this sort of thing.</p>
<p>Given Swift's apparent general reliance on <em>not</em> throwing errors but instead
using <code>Optional</code> and <code>nil</code> to signify issues, it sort of came as no surprise
that its approach to implementing something like <code>try</code>...<code>finally</code> is
actually divorced from <code>try</code>. I'm not sure how I feel about it yet, but
<code>defer</code> makes sense.</p>
<p>Here's an utterly useless bit of code that demonstrates how it works:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span> <span class="kc">_</span> <span class="n">n1</span> <span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="kc">_</span> <span class="n">n2</span> <span class="p">:</span> <span class="nb">Int</span> <span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>

    <span class="k">defer</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span> <span class="s">&quot;Huh! We did some adding!&quot;</span> <span class="p">)</span>
    <span class="p">}</span>

    <span class="bp">print</span><span class="p">(</span> <span class="s">&quot;About to do the add and then return&quot;</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span> <span class="n">add</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
</code></pre></div>

<p>When run, the output is this:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>swift<span class="w"> </span>run
<span class="o">[</span><span class="m">3</span>/3<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>try-defer
About<span class="w"> </span>to<span class="w"> </span><span class="k">do</span><span class="w"> </span>the<span class="w"> </span>add<span class="w"> </span>and<span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="k">return</span>
Huh!<span class="w"> </span>We<span class="w"> </span>did<span class="w"> </span>some<span class="w"> </span>adding!
<span class="m">4</span>
</code></pre></div>

<p>A <code>defer</code> (and there can be multiple) is tied to the block that it's
declared in, and is executed when the block exits. This is, of course, going
to be really handy for things like resource-management where you don't want
to be leaking something, although I can imagine a few other uses too (none
of which are really going to be novel for someone who's coded in other
languages with similar constructs).</p>
<p>What I find interesting about this is that one or more <code>defer</code> blocks can be
declared at various locations within a block of code; this obviously makes
sense in that you might not want to be handling the tidy-up of something
you've not got around to creating yet. But there's also part of me feels
uneasy about the "exit" code being declared further up the body of code,
rather than down towards the end. On the other hand I think I do appreciate
the idea of, up front, writing "look, any time there's a GTFO in the code
that follows, this will happen" -- you're made aware pretty quickly of what
to expect.</p>
<p>Anyway, it's good to know Swift has something similar to a <code>finally</code>.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://github.com/davep">GitHub</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://fosstodon.org/@davep">Mastodon</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'blogdaveporg';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>