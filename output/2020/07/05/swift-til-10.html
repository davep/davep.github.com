<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>"Swift TIL 10"</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dave Pearson">

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.dark.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.dark.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">

    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="blog.davep.org ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">blog.davep.org </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li class="active">
                    <a href="/category/misc.html">
						<i class="icon-folder-open icon-large"></i>misc
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to "Swift TIL 10"">
                                        "Swift TIL 10"
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2020-07-05T15:27:00+01:00">
        <i class="icon-calendar"></i>Sun 05 July 2020
</abbr>
<span class="label">By</span>
<a href="/author/dave-pearson.html"><i class="icon-user"></i>Dave Pearson</a>
<span class="label">Category</span>
<a href="/category/misc.html"><i class="icon-folder-open"></i>misc</a>.


<span class="label">Tags</span>
	<a href="/tag/swift.html"><i class="icon-tag"></i>[ "swift"</a>
	<a href="/tag/apple.html"><i class="icon-tag"></i>"apple"</a>
	<a href="/tag/til.html"><i class="icon-tag"></i>"TIL" ]</a>
</footer><!-- /.post-info -->                </div>
                <p>My leisurely journey into getting to know Swift by reading and then making
notes to myself in my blog continues, and this weekend I encountered
<code>defer</code>. As I was reading about Swift I did keep wondering when something
like <code>try</code> (it has <code>try</code>), <code>catch</code> (it has <code>catch</code>) and <code>finally</code> (it
doesn't have <code>finally</code>, but...) might crop up. This weekend I hit the part
of the book that covered this sort of thing.</p>
<p>Given Swift's apparent general reliance on <em>not</em> throwing errors but instead
using <code>Optional</code> and <code>nil</code> to signify issues, it sort of came as no surprise
that its approach to implementing something like <code>try</code>...<code>finally</code> is
actually divorced from <code>try</code>. I'm not sure how I feel about it yet, but
<code>defer</code> makes sense.</p>
<p>Here's an utterly useless bit of code that demonstrates how it works:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span> <span class="kc">_</span> <span class="n">n1</span> <span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="kc">_</span> <span class="n">n2</span> <span class="p">:</span> <span class="nb">Int</span> <span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>

    <span class="k">defer</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span> <span class="s">&quot;Huh! We did some adding!&quot;</span> <span class="p">)</span>
    <span class="p">}</span>

    <span class="bp">print</span><span class="p">(</span> <span class="s">&quot;About to do the add and then return&quot;</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span> <span class="n">add</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>
</code></pre></div>

<p>When run, the output is this:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>swift<span class="w"> </span>run
<span class="o">[</span><span class="m">3</span>/3<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>try-defer
About<span class="w"> </span>to<span class="w"> </span><span class="k">do</span><span class="w"> </span>the<span class="w"> </span>add<span class="w"> </span>and<span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="k">return</span>
Huh!<span class="w"> </span>We<span class="w"> </span>did<span class="w"> </span>some<span class="w"> </span>adding!
<span class="m">4</span>
</code></pre></div>

<p>A <code>defer</code> (and there can be multiple) is tied to the block that it's
declared in, and is executed when the block exits. This is, of course, going
to be really handy for things like resource-management where you don't want
to be leaking something, although I can imagine a few other uses too (none
of which are really going to be novel for someone who's coded in other
languages with similar constructs).</p>
<p>What I find interesting about this is that one or more <code>defer</code> blocks can be
declared at various locations within a block of code; this obviously makes
sense in that you might not want to be handling the tidy-up of something
you've not got around to creating yet. But there's also part of me feels
uneasy about the "exit" code being declared further up the body of code,
rather than down towards the end. On the other hand I think I do appreciate
the idea of, up front, writing "look, any time there's a GTFO in the code
that follows, this will happen" -- you're made aware pretty quickly of what
to expect.</p>
<p>Anyway, it's good to know Swift has something similar to a <code>finally</code>.</p>
                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "2020/07/05/swift-til-10.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'https://blogdaveporg.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><a href="https://github.com/davep"><i class="icon-external-link"></i>GitHub</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="/" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="https://fosstodon.org/@davep"><i class="icon-Mastodon-sign icon-large"></i>Mastodon</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/misc.html">
    <i class="icon-folder-open icon-large"></i>misc
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is based on <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->


<script type="text/javascript">
    var disqus_shortname = 'blogdaveporg';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>