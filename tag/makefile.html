<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="blogmore v1.0.0">
    <title>Tag: Makefile - davep</title>
    
    <link rel="icon" href="/icons/favicon.ico">
    
    
    <!-- Shortcut icon for backward compatibility -->
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Favicon alternatives -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-touch-icon-167.png">
    <!-- Android/Chrome -->
    <link rel="manifest" href="/icons/site.webmanifest">
    <!-- Windows/Edge -->
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/fontawesome.css">
    
    <link rel="stylesheet" href="/static/styles.min.css">
    
    
    <link rel="alternate" type="application/rss+xml" title="davep - RSS Feed" href="https://blog.davep.org/feed.xml">
    <link rel="alternate" type="application/atom+xml" title="davep - Atom Feed" href="https://blog.davep.org/feeds/all.atom.xml">
    
    
    
    <meta name="author" content="Dave Pearson">
    
    
    
<meta property="og:title" content="Tag: Makefile - davep">

<meta name="description" content="Dave Pearson&#39;s personal blog">
<meta property="og:description" content="Dave Pearson&#39;s personal blog">
<meta name="twitter:description" content="Dave Pearson&#39;s personal blog">


<meta name="keywords" content="Emacs, Python, Programming, Terminal, Textual">


    <script src="/static/theme.min.js"></script>
    
</head>
<body>
    <div class="site-container">
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    
                    <div class="sidebar-logo">
                        <a href="/">
                            <img src="/logo.jpeg" alt="davep">
                        </a>
                    </div>
                    

                    <div class="sidebar-title">
                        <h1><a href="/">davep</a></h1>
                        
                        <p class="sidebar-subtitle">Code and stuff</p>
                        
                    </div>
                </div>

                
                <div class="sidebar-pages">
                    <ul class="sidebar-links">
                        
                        <li><a href="/about.html">About</a></li>
                        
                        <li><a href="/dotfiles.html">Dot Files</a></li>
                        
                    </ul>
                </div>
                

                
                <section class="sidebar-section">
                    <h2>Links</h2>
                    <ul class="sidebar-links">
                        
                        <li><a href="https://davep.at/" target="_blank" rel="noopener noreferrer">davep@</a></li>
                        
                        <li><a href="https://raindrop.io/davep/public-46742255/sort=-created&amp;perpage=30&amp;page=0" target="_blank" rel="noopener noreferrer">Bookmarks</a></li>
                        
                        <li><a href="https://seenbydavep.blogspot.com/" target="_blank" rel="noopener noreferrer">Photoblog</a></li>
                        
                        <li><a href="https://elisp.dev/" target="_blank" rel="noopener noreferrer">Emacs Packages</a></li>
                        
                        <li><a href="https://pypi.org/user/davepearson/" target="_blank" rel="noopener noreferrer">Python Packages</a></li>
                        
                    </ul>
                </section>
                

                
                <section class="sidebar-section">
                    <h2>Social</h2>
                    <div class="sidebar-socials">
                        
                        <a href="https://www.flickr.com/photos/davepearson/" title="flickr" aria-label="flickr" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-flickr"></i>
                        </a>
                        
                        <a href="https://github.com/davep" title="github" aria-label="github" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-github"></i>
                        </a>
                        
                        <a href="https://www.last.fm/user/davepdotorg" title="lastfm" aria-label="lastfm" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-lastfm"></i>
                        </a>
                        
                        <a href="https://fosstodon.org/@davep" title="mastodon" aria-label="mastodon" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-mastodon"></i>
                        </a>
                        
                        <a href="https://www.npmjs.com/~davep.org" title="npm" aria-label="npm" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-npm"></i>
                        </a>
                        
                        <a href="https://steamcommunity.com/id/davepdotorg" title="steam" aria-label="steam" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-steam"></i>
                        </a>
                        
                        <a href="https://www.youtube.com/user/daveporg" title="youtube" aria-label="youtube" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-youtube"></i>
                        </a>
                        
                    </div>
                </section>
                
            </div>
        </aside>

        <div class="main-wrapper">
            <header>
                <nav>
                    <ul>
                        <li><a href="/categories.html">Categories</a></li>
                        <li><a href="/tags.html">Tags</a></li>
                        <li><a href="/archive.html">Archive</a></li>
                        
                        <li><a href="/search.html">Search</a></li>
                        
                        
                        <li><a href="/feed.xml" title="Subscribe via RSS feed">RSS</a></li>
                        <li><a href="/feeds/all.atom.xml" title="Subscribe via Atom feed">Atom</a></li>
                        
                        <li>
                            <button class="theme-toggle" type="button" aria-label="Toggle theme">
                                <span class="icon light-icon">‚òÄÔ∏è</span>
                                <span class="icon dark-icon">üåô</span>
                                <span class="theme-label">Theme</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </header>

            <main>
                
<div class="tag-page">
    <h1>Posts tagged with "Makefile"</h1>
    
    
    
    <article class="post-summary">
        <h2><a href="/2024/03/10/homebrew-all-the-python-things.html">Homebrew all the Python things</a></h2>
        
        <time datetime="2024-03-10T14:12:00+00:00"><a href="/2024/">2024</a>-<a href="/2024/03/">03</a>-<a href="/2024/03/10/">10</a> 14:12:00 UTC</time>
        
        <div class="reading-time">4 min read</div>
        
        <div class="category">
            <a href="/category/coding.html" class="category-link">Coding</a>
        </div>
        
        <div class="post-content">
            <p>Over the past year and a half I've written a <em>lot</em> of Python code, and a lot
of that Python code has been Textual applications; most of those Textual
applications have been very quick demonstration or test applications built
to help support someone asking for help; some of them have been less-trivial
applications written in my own time and for my own use and amusement. Of
them I'd say there are two near-daily-drivers, and a couple that I either
have more plans for, or like to maintain just for the hell of it.</p>
<p>Those latter applications are all ones that <a href="https://pypi.org/user/davepearson/" rel="noopener noreferrer" target="_blank">I've deployed to
PyPI</a>, and because of that are all ones
that I've recommenced be installed using
<a href="https://pipx.pypa.io/stable/" rel="noopener noreferrer" target="_blank"><code>pipx</code></a>. During that time though I've had
half an inclination to make them <a href="https://brew.sh/" rel="noopener noreferrer" target="_blank">installable via
Homebrew</a>. While probably not installable from the core
Homebrew repository<sup id="fnref:193-1"><a class="footnote-ref" href="#fn:193-1">1</a></sup>, at least installable from a "tap"<sup id="fnref:193-2"><a class="footnote-ref" href="#fn:193-2">2</a></sup> that's under
my own GitHub account or something.</p>
<p>To this end I've had <a href="https://til.simonwillison.net/homebrew/packaging-python-cli-for-homebrew" rel="noopener noreferrer" target="_blank">a blog post about packaging Python apps for
Homebrew</a>
saved in Pinboard for a while now, and every time I look at it I think
<em>"this is a lot of faff, maybe later"</em>. Today was that "later".</p>
<p>As it turned out, it was <em>way</em> easier than I first realised. The evolution
of today pretty much went like this:</p>
<h2 id="deciding-to-use-a-single-repository-as-the-tap">Deciding to use a single repository as the "tap"</h2>
<p>The blog post above seemed to suggest that for every application repository
you want a tap for, you probably want a parallel <code>homebrew-</code>-prefixed
repository. This in turn would suggest that every time someone wants to
install one of your tools, they'd need to add a new tap<sup id="fnref:193-3"><a class="footnote-ref" href="#fn:193-3">3</a></sup>. As I looked at
it this seemed like way too much faff, so in the end I decided <a href="https://github.com/davep/homebrew-homebrew" rel="noopener noreferrer" target="_blank">to create a
single repository that I'd keep all my formula files
in</a>. The naming of
<code>homebrew-homebrew</code> meant that the tap name would simply be
<code>davep/homebrew</code>.</p>
<p>Simple and clean, I think: things for homebrew, things that can be installed
via homebrew, that come from davep. To add the tap it's simply:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>brew<span class="w"> </span>tap<span class="w"> </span>davep/homebrew
</code></pre></div>

<h2 id="ensuring-that-all-my-applications-and-libraries-publish-source">Ensuring that all my applications and libraries publish source</h2>
<p>Although it seems that it might be (possibly, maybe, perhaps, who can tell?)
deprecated, it looked like
<a href="https://github.com/tdsmith/homebrew-pypi-poet" rel="noopener noreferrer" target="_blank"><code>homebrew-pypi-poet</code></a> was a
tool I'd need to do all the heavy work on making the formula file. A quick
test threw up a problem where it was complaining that my test package (one
of my own applications) didn't have an <code>sdist</code>. Sure enough, through nothing
more than never having bothered to make it happen, the source of my
libraries and applications wasn't been uploaded to PyPI when I published.</p>
<p>So I went through some of my repositories and fixed that, making patch
releases as I went.</p>
<h2 id="making-a-makefile-to-let-me-be-lazy">Making a <code>Makefile</code> to let me be lazy</h2>
<p>The next thing to do was to figure out the most lazy way of building the
formula files. From what I could see the main steps to making all of this
work were:</p>
<ul>
<li>Make a venv and activate it</li>
<li>Install <code>homebrew-pypi-poet</code></li>
<li>Install the package you want to package for Homebrew</li>
<li>Run <code>poet</code> to make the formula</li>
</ul>
<p>Seemed simple enough. For all sorts of lazy reasons I still tend to use
<code>pipenv</code> to get things done quickly, and that seemed to work fine here too.
I'm also a fan of <code>PIPENV_VENV_IN_PROJECT=true</code> which makes things clean and
tidy, so I figured a rule in a <code>Makefile</code> like this:</p>
<div class="highlight"><pre><span></span><code><span class="nf">clean</span><span class="o">:</span>
<span class="w">        </span>rm<span class="w"> </span>-rf<span class="w"> </span>.venv
<span class="w">        </span>rm<span class="w"> </span>-f<span class="w"> </span>Pipfile<span class="w"> </span>Pipfile.lock
<span class="w">        </span>pipenv<span class="w"> </span>--python<span class="w"> </span><span class="m">3</span>.12
<span class="w">        </span>pipenv<span class="w"> </span>install<span class="w"> </span>--dev<span class="w"> </span>homebrew-pypi-poet
</code></pre></div>

<p>would be fine to make a clean venv ready to build the formula, and then I'd
have a rule for the package itself that depended on the above, like this:</p>
<div class="highlight"><pre><span></span><code><span class="nf">oshit</span><span class="o">:</span><span class="w"> </span><span class="n">clean</span>
<span class="w">        </span>pipenv<span class="w"> </span>install<span class="w"> </span>oshit
<span class="w">        </span>pipenv<span class="w"> </span>run<span class="w"> </span>poet<span class="w"> </span>-f<span class="w"> </span>oshit<span class="w"> </span>&gt;<span class="w"> </span>Formula/oshit.rb
</code></pre></div>

<h2 id="fixing-the-package-description">Fixing the package description</h2>
<p>The above was great, and worked really well. But there was one issue that I
could see: the resulting formula file always had this <code>desc</code> inside it:</p>
<div class="highlight"><pre><span></span><code><span class="n">desc</span><span class="w"> </span><span class="s2">&quot;Shiny new formula&quot;</span>
</code></pre></div>

<p>From what I could see there was no way to tell <code>poet</code> what I wanted the
description to be, and neither did I want to have to remember to edit that
line each time I regenerated the formula file. So <code>sed</code> to the rescue then I
guess, with this sort of thing:</p>
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;s/Shiny new formula/The actual text I want/&#39;</span><span class="w"> </span>Formula/coolapp.rb
</code></pre></div>

<h2 id="the-result">The result</h2>
<p>The result of all of this is that I now have <a href="https://github.com/davep/homebrew-homebrew" rel="noopener noreferrer" target="_blank">a repository that I or anyone
else can use as a tap</a> to be
able to install my stuff using the <code>brew</code> command. So now if you want a
little Hacker News reader for the terminal but you don't want to be messing
with installing <code>pipx</code> and the like, but you do use <code>brew</code> on your machine,
it's just this:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>brew<span class="w"> </span>tap<span class="w"> </span>davep/homebrew
$<span class="w"> </span>brew<span class="w"> </span>install<span class="w"> </span>oshit
</code></pre></div>

<p>Fingers crossed it all "just works" when I next upgrade one of those
packages. I will, of course, have to remember to go into
<code>davep/homebrew-homebrew</code> and <code>make the-app</code> for the relevant application,
and then commit and push the changes, but that's really not too difficult to
remember and do.</p>
<p>Hopefully it'll then all just work.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:193-1">
<p>I do actually <a href="https://formulae.brew.sh/formula/eg" rel="noopener noreferrer" target="_blank">have one package in
Homebrew</a>, but it wasn't me who put
it there.&#160;<a class="footnote-backref" href="#fnref:193-1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:193-2">
<p>I really like Homebrew as a tool for getting stuff installed, by oh my
gods the naming of things in its ecosystem is terrible and confusing!&#160;<a class="footnote-backref" href="#fnref:193-2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:193-3">
<p>No, really, I mean it, this naming convention is kinda cringe right?&#160;<a class="footnote-backref" href="#fnref:193-3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>
        </div>
        
        <div class="tags">
            
            <a href="/tag/python.html" class="tag">Python</a>
            
            <a href="/tag/terminal.html" class="tag">terminal</a>
            
            <a href="/tag/textual.html" class="tag">textual</a>
            
            <a href="/tag/homebrew.html" class="tag">Homebrew</a>
            
            <a href="/tag/makefile.html" class="tag">Makefile</a>
            
        </div>
        
    </article>
    
    
    
    
</div>

            </main>

            <footer>
                <p>Generated with <a href="https://github.com/davep/blogmore" target="_blank" rel="noopener noreferrer">Blogmore</a></p>
            </footer>
        </div>
    </div>
</body>
</html>