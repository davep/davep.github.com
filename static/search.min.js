(function(){'use strict';let searchIndex=null;function loadIndex(){if(searchIndex!==null){return Promise.resolve(searchIndex);}
return fetch('/search_index.json').then(function(response){if(!response.ok){throw new Error('Could not load search index');}
return response.json();}).then(function(data){searchIndex=data;return data;});}
function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
function highlight(text,query){if(!query){return escapeHtml(text);}
return escapeHtml(text).replace(new RegExp('('+escapeRegExp(escapeHtml(query))+')','gi'),'<mark>$1</mark>');}
function escapeHtml(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}
function snippet(content,query,radius){radius=radius||120;const lower=content.toLowerCase();const pos=lower.indexOf(query.toLowerCase());if(pos===-1){return content.slice(0,radius*2);}
const start=Math.max(0,pos-radius);const end=Math.min(content.length,pos+query.length+radius);let text=content.slice(start,end);if(start>0){text='\u2026'+text;}
if(end<content.length){text=text+'\u2026';}
return text;}
function search(index,query){const lower=query.toLowerCase().trim();if(!lower){return[];}
return index.filter(function(entry){return(entry.title.toLowerCase().includes(lower)||entry.content.toLowerCase().includes(lower));});}
function renderResults(results,query,container){if(results.length===0){container.innerHTML='<p class="search-no-results">No results found.</p>';return;}
const items=results.map(function(entry){const titleHtml=highlight(entry.title,query);const contentSnippet=snippet(entry.content,query);const snippetHtml=highlight(contentSnippet,query);const dateHtml=entry.date?'<span class="search-result-date">'+
escapeHtml(entry.date)+'</span>':'';return('<li class="search-result">'+'<h3 class="search-result-title">'+'<a href="'+
escapeHtml(entry.url)+'">'+
titleHtml+'</a>'+'</h3>'+
dateHtml+'<p class="search-result-snippet">'+
snippetHtml+'</p>'+'</li>');});container.innerHTML='<p class="search-result-count">'+
results.length+' result'+
(results.length===1?'':'s')+' found</p>'+'<ul class="search-results-list">'+
items.join('')+'</ul>';}
function init(){const form=document.getElementById('search-form');const input=document.getElementById('search-input');const resultsContainer=document.getElementById('search-results');if(!form||!input||!resultsContainer){return;}
loadIndex().catch(function(){resultsContainer.innerHTML='<p class="search-error">Search index could not be loaded.</p>';});function runSearch(){const query=input.value;if(!query.trim()){resultsContainer.innerHTML='';return;}
loadIndex().then(function(index){const results=search(index,query);renderResults(results,query,resultsContainer);}).catch(function(){resultsContainer.innerHTML='<p class="search-error">Search index could not be loaded.</p>';});}
input.addEventListener('input',runSearch);form.addEventListener('submit',function(event){event.preventDefault();runSearch();});const params=new URLSearchParams(window.location.search);const initialQuery=params.get('q');if(initialQuery){input.value=initialQuery;runSearch();}}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();