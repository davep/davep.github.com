
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://blog.davep.org/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://blog.davep.org/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://blog.davep.org/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://blog.davep.org/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="https://blog.davep.org/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://blog.davep.org/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://blog.davep.org/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="https://blog.davep.org/static/davep.css">

  <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon">


  <link href="https://blog.davep.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="blog.davep.org Atom">








 

    <meta name="author" content="Dave Pearson" />
    <meta name="description" content="" />
  <meta property="og:site_name" content="blog.davep.org"/>
  <meta property="og:type" content="blog"/>
  <meta property="og:title" content="blog.davep.org"/>
  <meta property="og:description" content=""/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://blog.davep.org"/>
  <meta property="og:image" content="/static/davep.jpeg">

  <title>blog.davep.org &ndash; Tag Lisp</title>


</head>
<body >

<aside>
  <div>
    <a href="https://blog.davep.org/">
      <img src="/static/davep.jpeg" alt="" title="">
    </a>

    <h1>
      <a href="https://blog.davep.org/"></a>
    </h1>



    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="https://blog.davep.org/pages/about.html#about">
                About
              </a>
            </li>

          <li>
            <a target="_self" href="http://davep.at/" >davep.at</a>
          </li>
          <li>
            <a target="_self" href="https://pinboard.in/u:davep" >Pinboard</a>
          </li>
          <li>
            <a target="_self" href="https://seenbydavep.blogspot.com/" >Photoblog</a>
          </li>
          <li>
            <a target="_self" href="https://pypi.org/user/davepearson/" >Python Packages</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/davep"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://fosstodon.org/@davep"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-flickr"
           href="https://www.flickr.com/photos/davepearson/"
           target="_blank">
          <i class="fa-brands fa-flickr"></i>
        </a>
      </li>
      <li>
        <a class="sc-lastfm"
           href="https://www.last.fm/user/davepdotorg"
           target="_blank">
          <i class="fa-brands fa-lastfm"></i>
        </a>
      </li>
      <li>
        <a class="sc-npm"
           href="https://www.npmjs.com/~davep.org"
           target="_blank">
          <i class="fa-brands fa-npm"></i>
        </a>
      </li>
      <li>
        <a class="sc-youtube"
           href="https://www.youtube.com/user/daveporg"
           target="_blank">
          <i class="fa-brands fa-youtube"></i>
        </a>
      </li>
      <li>
        <a class="sc-steam"
           href="https://steamcommunity.com/id/davepdotorg"
           target="_blank">
          <i class="fa-brands fa-steam"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://blog.davep.org/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>

  <a href="https://blog.davep.org/feeds/all.atom.xml">Atom</a>

</nav>



<article>
  <header>
    <h2><a href="https://blog.davep.org/2022/08/23/I-must-be-getting-old.html#I-must-be-getting-old">I must be getting old</a></h2>
    <p>
      Posted on 2022-08-23 21:31 +0100 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>A little earlier this evening I got <a href="https://github.com/davep/boxquote.el/issues/7">a new
issue</a> raised against
<a href="(https://github.com/davep/boxquote.el/issues/7)"><code>boxquote.el</code></a>. Apparently
Emacs 29 (I'm running 28.1 as of the time of writing) is moaning about the
likes of:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nf">point</span><span class="p">)</span><span class="w"> </span><span class="nv">some-location-or-other</span><span class="p">)</span>
</code></pre></div>

<p>and</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nf">buffer-string</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</code></pre></div>

<p>There's a whole background to why I've tended to code like that, that stems
from enjoying Common Lisp, my days reading (and sometimes posting to)
<code>comp.lang.lisp</code>, and I <em>think</em> some of the stuff <a href="https://en.wikipedia.org/wiki/Erik_Naggum">Erik
Naggum</a> wrote back in the day. I
won't get into it all now; I'm not sure I can even remember a lot of how I
got there given how far back it was.</p>
<p>But...</p>
<p>Wanting to quickly get to the bottom of why the above was suddenly an issue,
I dived into the <code>NEWS</code> file and <a href="https://github.com/emacs-mirror/emacs/blob/67a15ce1564ce35ece24a19f00e03a36e0575746/etc/NEWS#L2585">found the
following</a>:</p>
<div class="highlight"><pre><span></span><code><span class="o">**</span><span class="w"> </span><span class="n">Many</span><span class="w"> </span><span class="n">seldom</span><span class="o">-</span><span class="n">used</span><span class="w"> </span><span class="n">generalized</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">made</span><span class="w"> </span><span class="n">obsolete</span><span class="o">.</span>
<span class="n">Emacs</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">rather</span><span class="w"> </span><span class="n">obscure</span><span class="w"> </span><span class="n">generalized</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="n">defined</span><span class="p">,</span>
<span class="n">that</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">say</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="n">like</span><span class="p">:</span>

<span class="w">   </span><span class="p">(</span><span class="n">setf</span><span class="w"> </span><span class="p">(</span><span class="n">point</span><span class="o">-</span><span class="nb">min</span><span class="p">)</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>

<span class="n">These</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">caught</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">made</span><span class="w"> </span><span class="n">obsolete</span><span class="o">.</span><span class="w">  </span><span class="n">The</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">above</span><span class="p">,</span>
<span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">saying</span>

<span class="w">   </span><span class="p">(</span><span class="n">narrow</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">region</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">(</span><span class="n">point</span><span class="o">-</span><span class="nb">max</span><span class="p">))</span>

<span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">generalized</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">made</span><span class="w"> </span><span class="n">obsolete</span><span class="p">:</span>
<span class="s1">&#39;buffer-file-name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;buffer-local-value&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;buffer-modified-p&#39;</span><span class="p">,</span>
<span class="s1">&#39;buffer-name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;buffer-string&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;buffer-substring&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;current-buffer&#39;</span><span class="p">,</span>
<span class="s1">&#39;current-column&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;current-global-map&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;current-input-mode&#39;</span><span class="p">,</span>
<span class="s1">&#39;current-local-map&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;current-window-configuration&#39;</span><span class="p">,</span>
<span class="s1">&#39;default-file-modes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;documentation-property&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;frame-height&#39;</span><span class="p">,</span>
<span class="s1">&#39;frame-visible-p&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;global-key-binding&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;local-key-binding&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mark&#39;</span><span class="p">,</span>
<span class="s1">&#39;mark-marker&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;marker-position&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mouse-position&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;point&#39;</span><span class="p">,</span>
<span class="s1">&#39;point-marker&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;point-max&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;point-min&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;read-mouse-position&#39;</span><span class="p">,</span>
<span class="s1">&#39;screen-height&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;screen-width&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;selected-frame&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;selected-screen&#39;</span><span class="p">,</span>
<span class="s1">&#39;selected-window&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;standard-case-table&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;syntax-table&#39;</span><span class="p">,</span>
<span class="s1">&#39;visited-file-modtime&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;window-height&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;window-width&#39;</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span>
<span class="s1">&#39;x-get-secondary-selection&#39;</span><span class="o">.</span>
</code></pre></div>

<p>As suggested above... this is my thing, this is how I coded some Elisp
stuff. Look through much of my <a href="https://elisp.dev/">Emacs Lisp code</a> and
you'll find me <code>setf</code>ing stuff all over the place.</p>
<p>Apparently my style is "obscure". Actually, I'm kinda okay with that if I'm
honest.</p>
<p>This is going to be a bit of a pain in the arse; I'm going to have to go
through a whole bunch of code and make it "less obscure", at some point.</p>
<p>But...</p>
<p>This isn't the part that had me thinking I must be getting old. Oh no. The
<code>NEWS</code> file had another little surprise in store:</p>
<div class="highlight"><pre><span></span><code><span class="o">**</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">quickurl</span><span class="p">.</span><span class="nx">el</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="nx">obsolete</span><span class="p">.</span>
<span class="nx">Use</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">abbrev</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">skeleton</span><span class="err">&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">tempo</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">instead</span><span class="p">.</span>
</code></pre></div>

<p>That.... that's me that is. Well, it's one of the me things. If you run
<code>about-emacs</code>, dive into <code>Authors</code>, and search for my name, in any copy of
GNU Emacs from the last decade or two, you'll find this:</p>
<div class="highlight"><pre><span></span><code>Dave Pearson: wrote 5x5.el quickurl.el
</code></pre></div>

<p><a href="https://github.com/davep/quickurl.el/blob/master/quickurl.el"><code>quickurl.el</code></a>
was a package I wrote back in the late 1990s, back when I was a very heavy
user of <a href="https://en.wikipedia.org/wiki/Usenet">Usenet</a>, and often found
myself posting the same URLs in posts again and again; especially in
<code>comp.lang.clipper</code>. As a fairly quick hack I wrote the code so that I could
very quickly insert often-used URLs.</p>
<p>Some time later, I got an email from the
<a href="https://en.wikipedia.org/wiki/Free_Software_Foundation">FSF</a> (I actually
think it was from <a href="https://en.wikipedia.org/wiki/Richard_Stallman">RMS</a> --
but that's an <a href="https://en.wikipedia.org/wiki/Mbox"><code>mbox</code></a> I've long ago
lost -- or a backup of it might be in storage back in England, on a DVD),
asking if I wanted to contribute it to Emacs proper. This seemed like an odd
thing to add to Emacs but, sure, why the hell not?</p>
<p>And so I had my second contribution to a body of code I used a lot (the
first being <a href="https://github.com/davep/5x5.el"><code>5x5.el</code></a> -- which itself was
my first ever attempt at writing some non-trivial Elisp code).</p>
<p>So... yeah... here we are. I'm now old enough to have written some Emacs
Lisp code, had it required by the FSF for inclusion in Emacs, had it live in
there for something like two decades, and then <em>become obselete</em>!</p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2020/06/07/some-more-dot-emacs-dot-d-evolution.html#some-more-dot-emacs-dot-d-evolution">Some more ~/.emacs.d evolution</a></h2>
    <p>
      Posted on 2020-06-07 16:48 +0100 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>When I started with this version of the blog on Hashnode<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>, my plan was to
try and write something at least once a week. I managed to do that as far as
January this year, give or take, but then things got a little busy, the
world got trickier, and... Well, <a href="https://en.wikipedia.org/wiki/COVID-19_pandemic">you don't need me to tell you about
that</a>. Anyway, I'm back to
write some more and, hopefully, try and keep up with writing. I feel it'll
do me good.</p>
<p>I have been busy since January. Work has, as far as possible, carried on as
normal. The only big difference being I'm back working from home. It's an
odd turn of events personally given that I'd worked from home for 21 years,
then (with some trepidation) <a href="/2017/12/12/on_to_something_new.html">went back to working in an
office</a>. Having got used to being in
an office and being around people, it took some adjusting to working alone
again.</p>
<p>So, on to the main point of this post... During that period I've spent a lot
more time at my machine than I would normally, and so it was inevitable that
I'd end up tinkering with <a href="https://github.com/davep/.emacs.d">my Emacs
configuration</a>. While it's true that
<a href="/2019/11/23/visual-evolution-of-emacs-config.html">there's hardly a week goes by where I don't tinker with some small
thing</a>, I try not to make
huge changes too often. Huge changes do happen though.</p>
<p>A handful of weeks back was another one of those times where I made a big
change.</p>
<p>After I <a href="/2016/05/26/starting_fresh_with_gnu_emacs.html">burnt my original <code>~/.emacs</code> file back in
2016</a> I've had an approach
where I've tried to make things as modular as possible, and as easy to clone
down to a new machine as possible. The design I came up with, <a href="/2017/07/13/more_revamping_of_my_emacs_config.html">especially
once I moved over to using
<code>use-package</code></a>, has
served me well. But there was always one thing that bothered me: the files
that handled the loading and configuration of packages were, in effect,
<a href="https://github.com/davep/.emacs.d/tree/728e74376bf5606d9ef2d297e36cc2d35e159d64/init.d/packages">still three large monolithic
files</a>.
While this was better than a single monolithic <code>~/.emacs</code>, it still didn't
feel quite right.</p>
<p>Giving it a bit of thought, I decided that what I really wanted was a single
directory in which I could drop lots of small <code>.el</code> files that would handle
the loading and configuration of all sorts of packages. While it didn't gain
anything concrete, the idea felt tidier. Tidy is good. Feeling like the code
smell is good, is good too.</p>
<p>First though I needed a way to load multiple files, ideally within a whole
directory hierarchy, without needing to know in advance what files would be
there. After a little bit of tinkering I settled on <a href="https://github.com/davep/.emacs.d/blob/c3d53152b1adc9ba5e43baddb986870b3244b113/init.d/init-packages.el#L42-L46">this bit of
code</a>
that revolves around the use of
<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Contents-of-Directories.html"><code>directory-files-recursively</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">source</span><span class="w"> </span><span class="p">(</span><span class="nf">expand-file-name</span><span class="w"> </span><span class="s">&quot;init.d/packages.d/&quot;</span><span class="w"> </span><span class="nv">user-emacs-directory</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nf">file-exists-p</span><span class="w"> </span><span class="nv">source</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">cl-loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">directory-files-recursively</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="p">(</span><span class="nb">rx</span><span class="w"> </span><span class="s">&quot;.el&quot;</span><span class="w"> </span><span class="nv">eol</span><span class="p">))</span>
<span class="w">             </span><span class="nb">do</span><span class="w"> </span><span class="p">(</span><span class="nf">load</span><span class="w"> </span><span class="p">(</span><span class="nv">file-name-sans-extension</span><span class="w"> </span><span class="nv">use</span><span class="p">)))))</span>
</code></pre></div>

<p>Simply put, this code finds every file in and below
<a href="https://github.com/davep/.emacs.d/tree/master/init.d/packages.d"><code>~/.emacs.d/init.d/packages.d/</code></a>
whose name ends in <code>.el</code> (note the use of a regular expression, using
<a href="/2019/12/01/being-phony-and-lispy-regular-expressions.html"><code>rx</code></a>
to create it), removes the extension from the name, and loads it with <code>load</code>
(dropping the extension means <code>load</code> can decide if it wants to load the
compiled version of the code, or the source, depending on what's available).</p>
<p>After writing that I could then start to populate
<code>~/.emacs.d/init.d/packages.d/</code> with lots of smaller files that handled the
loading of packages. In some cases there's a file just for one package, in
other cases there's a file that handles a logical grouping of packages
(where there are obvious direct dependencies, or where one package is
designed to extend the other, etc). For now I've decided to break things
down into three directories that map to the three monolithic files I had
before:</p>
<p><img alt="Screenshot 2020-06-07 at 16.36.28.png" src="/attachments/2020/06/07/Screenshot 2020-06-07 at 16.36.28.png"></p>
<p>However, I'm not totally wedded to this design and I may change this as time
goes on.</p>
<p>While I've not spent any time properly testing it out, I've also not really
noticed any obvious impact on startup speed. However, this tends not to be a
real concern for me. I seldom <em>start</em> Emacs anyway. I always have it running
<a href="https://github.com/davep/e">and use <code>emacsclient</code> as my editor in most places so files open instantly
in the running version of Emacs</a>.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>Note from future me: we're now back over on <code>blog.davep.org</code> of
course.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2020/01/19/dnote-el.html#dnote-el">dnote.el - A wrapper for the dnote CLI</a></h2>
    <p>
      Posted on 2020-01-19 16:35 +0000 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>Late on last year I stumbled on an article about
<a href="https://www.getdnote.com/">dnote</a>. Annoyingly, I can't recall now where I
saw it, but I made a reminder to look at it over my Christmas break.</p>
<p>Dnote looked like a tool that would fill a hole I had in how I work. When it
comes to making notes about things, and keeping things for future reference,
I use a few tools, each one being just right (for me) for the job in
question. I use <a href="https://evernote.com/">Evernote</a> to track documents and
other household type things. I use <a href="https://www.google.com/keep/">Keep</a> to
make notes about stuff I need to remember short-term (say, the size of a
space in my bedroom that I want furniture to go in) and also to record notes
while in meetings at work. I use <a href="https://journey.cloud/">Journey</a> to keep a
journal about... anything, really. Finally, <a href="https://pinboard.in/u:davep">I use
Pinboard</a> to keep hold of URLs I might want to
go back to (I also use it to create a to-read list).</p>
<p>Amongst all of this, however, I felt I was missing something for keeping
track of things that don't really fall into any of the categories above.
Mostly this would be work-based or hacking-based things that are short and
sweet but I don't always use enough to easily remember. I wanted just the
right tool that would let me ferret away useful one-liners, remind myself of
obscure switches that get used once or twice a year, etc.</p>
<p>After reading up on dnote it seemed pretty clear that this was just such a
tool.</p>
<p>After getting back to the office at the start of this month I decided to
make use of it and see how it went. My idea was simple: I'd record any "TIL"
stuff that I might want to remember in the future, as well as recording
things I need now and again but can't always remember.</p>
<p>So far it's working quite well. I like that it has a simple CLI. I like that
it's got a backend that you can use to sync between different machines. I
like that it's got a web interface that's mobile-friendly. I like that <a href="https://github.com/dnote/dnote">it's
Free Software</a> and so you can host your own
server if you wish.</p>
<p>I found I liked it enough that, of course, I felt the need to start <a href="https://github.com/davep/dnote.el">a
simple Emacs wrapper for the CLI</a>.</p>
<p>At the moment dnote.el is designed to be a simple capture system. There are
commands for capturing a one-liner (entered in the Emacs mini-buffer), for
capturing the content of the current buffer, and for capturing
freshly-entered multi-line text, entered in a buffer that uses
<code>markdown-mode</code>. There's also a command for syncing notes if you have
configured dnote to talk to a backend.</p>
<p>What I don't have right now is the ability to navigate and view notes. So
far I've not really felt the need for that because the CLI approach works so
well. Longer-term though I can see my tweaking this and adding in commands
for searching, viewing, editing and deleting notes.</p>
<p>But, for now, if you've not had a look at dnote, I'd highly recommend having
a play and seeing if it makes sense for you. And, if it does, and you're an
Emacs user, perhaps dnote.el will be useful too?</p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2019/12/14/nuke-buffers-el.html#nuke-buffers-el">nuke-buffers.el -- Tidy up open buffers in Emacs</a></h2>
    <p>
      Posted on 2019-12-14 13:17 +0000 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>Both at work and at home I use Emacs by <a href="https://github.com/davep/longmacs.el">keeping a copy running all the
time</a>, and use <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Emacs-Server.html#Emacs-Server"><code>emacsclient</code> to open
files inside
it</a>
(including on remote machines thanks to a bit of
<a href="https://en.wikipedia.org/wiki/Secure_Shell"><code>ssh</code></a> and heavy use of
<a href="https://www.gnu.org/software/tramp/"><code>tramp</code></a> -- I might write this up at
some point). This works really well, but does mean I tend to build up a lot
of buffers over time.</p>
<p>Having lots of buffers open isn't generally an issue, and if I'm working on
lots of different files in a project during the course of a hacking session
it's actually a good thing. But, quite often, I want to tidy up the buffer
list, clearing it back to near-zero buffers open. Many years ago, when I had
a "proper" tower system running 24/7, with Emacs open all the time, I'd use
<a href="https://www.emacswiki.org/emacs/MidnightMode"><code>clean-buffer-list</code> as part of
<code>midnight</code></a>. Along the way
that fell out of favour with me, likely because I drifted into using
machines that had Emacs open all the time but where the machine wasn't awake
all the time.</p>
<p>Eventually I decided to have some fun rolling my own solution, and
<a href="https://github.com/davep/nuke-buffers.el"><code>nuke-buffers</code></a> was born.</p>
<p>Rather than try and do things in an automated way, this was designed to be
<a href="https://github.com/davep/.emacs.d/blob/ffc863ca0fb669d2f6639bda62e81764c35767ce/init.d/packages/init-packages-delpa.el#L98-L107">bound to a key (or
two)</a>
and then be run when I wanted, being as harsh as possible about cleaning up
the buffer list. Since first writing it it's worked well for me.</p>
<p>These days I tend to let the buffer list build up as I work on a new
feature, or chase down a bug, etc. Then, once I've made the final commit for
that period of focus, I'll hit the <code>nuke-buffer</code> key combo as the final act
of confirming that I've done the job. So not only does this help tidy my
Emacs session a bit, it also feels like a physical form of punctuation --
back in less sensible days, when I had some terrible habits, it would have
been when I'd reach for the celebratory cigarette; buffer-tidying feels far
more wholesome. ;)</p>
<p>The way the code works is, of course, mostly directed at how I work -- it's
highly likely it wouldn't make sense for many other people. The main aim is
to kill as many buffers as possible, but without disturbing anything else.
The list of buffers it gathers for nuking avoids buffers that are <a href="https://github.com/davep/nuke-buffers.el/blob/d018499b78968f074565c076068f657a1631aa07/nuke-buffers.el#L60-L62">visiting
files but have unsaved
content</a>,
avoids <a href="https://github.com/davep/nuke-buffers.el/blob/d018499b78968f074565c076068f657a1631aa07/nuke-buffers.el#L54">the
minibuffer</a>
(obviously), avoids <a href="https://github.com/davep/nuke-buffers.el/blob/d018499b78968f074565c076068f657a1631aa07/nuke-buffers.el#L56">any "special"
buffer</a>
(one that starts with a space then an asterisk), avoids <a href="https://github.com/davep/nuke-buffers.el/blob/d018499b78968f074565c076068f657a1631aa07/nuke-buffers.el#L73">the current
buffer</a>
and also avoids <a href="https://github.com/davep/nuke-buffers.el/blob/d018499b78968f074565c076068f657a1631aa07/nuke-buffers.el#L58">any buffer in a list of names to
avoid</a>.</p>
<p>I've being using this on a daily basis for around 2.5 years now and it's
done the job without ever losing me any work.</p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2019/12/01/being-phony-and-lispy-regular-expressions.html#being-phony-and-lispy-regular-expressions">Being phony, and Lispy regular expressions</a></h2>
    <p>
      Posted on 2019-12-01 16:42 +0000 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>While it does seem that they're a little out of fashion these days, in some
circles anyway, I'm still an avid fan of <code>make</code> and make files. Even in
environments where I don't need a <code>Makefile</code> to actually build anything,
I'll use one (or more) to help create handy shortcuts for getting stuff
done.</p>
<p>Looking at the main <code>Makefile</code> for one of my major work projects, there's 45
targets that help fire off various jobs (all of them <a href="https://marmelab.com/blog/2016/02/29/auto-documented-makefile.html">self-documenting using
a variation on an approach I read a while
back</a>).</p>
<p>In most cases the targets aren't real targets. That's to say, they don't
build the thing they're called. They are <a href="https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html">phony
targets</a>.
So, as makes sense, I make a point of marking them all as such. I follow the
convention that has the <code>.PHONY</code> marker appear on the line before the
target; this feels cleaner to me and easier to follow and maintain.</p>
<p>But.... I'm lazy. And I use Emacs. Typing out <code>.PHONY foo</code> all the time
feels like far too much work. So, some time ago, I quickly threw together
<a href="https://github.com/davep/make-phony.el"><code>make-phony.el</code></a>.</p>
<p>With this I could be <em>really</em> lazy. I could type out the <code>Makefile</code> target
and then, with my cursor on it, press a key combination and have the
<code>.PHONY</code> marker put in place.</p>
<p>Does it save much time? Yeah, probably not really. But it was a fun little
exercise and an excuse to write a little bit of Emacs Lisp.</p>
<p>There's one thing I made a point of doing in the heart of this too: using
<code>rx</code>. For anyone who doesn't know of it, think of it as a very Lispy way of
writing regular expressions. I won't even try and explain it all here
<a href="http://francismurillo.github.io/2017-03-30-Exploring-Emacs-rx-Macro/">because others have done an excellent job
already</a>.
What I will do is say this: if you're in the habit of writing some Emacs
Lisp, or even tinkering with your configuration, and you find yourself
writing a regular expression, consider looking at <code>rx</code> -- it's well worth
the time to get to know it.</p>
<p>Slowly, as time goes on, I'm weeding out "vanilla" regular expressions from
my config and code and moving over to using <code>rx</code>. I feel, quite rightly I
think, that <a href="https://github.com/davep/.emacs.d/blob/b3185a1dbaa0a16f540465844b84c5e1c6a77180/init.d/packages/init-packages-melpa.el#L117-L126">something like
this</a>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">rx</span>
<span class="w"> </span><span class="p">(</span><span class="k">or</span>
<span class="w">  </span><span class="c1">;; Ignore hidden files.</span>
<span class="w">  </span><span class="p">(</span><span class="nv">group</span><span class="w"> </span><span class="nv">bol</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="c1">;; I never want to edit the desktop.</span>
<span class="w">  </span><span class="p">(</span><span class="nv">group</span><span class="w"> </span><span class="s">&quot;Desktop/&quot;</span><span class="w"> </span><span class="nv">eol</span><span class="p">)</span>
<span class="w">  </span><span class="c1">;; Ignore compiled files.</span>
<span class="w">  </span><span class="p">(</span><span class="nv">group</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="s">&quot;pyc&quot;</span><span class="w"> </span><span class="s">&quot;elc&quot;</span><span class="p">)</span><span class="w"> </span><span class="nv">eol</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">group</span><span class="w"> </span><span class="s">&quot;.egg-info/&quot;</span><span class="w"> </span><span class="nv">eol</span><span class="p">)))</span>
</code></pre></div>

<p>is much easier to write, read and maintain, than this:</p>
<div class="highlight"><pre><span></span><code>&quot;\\(^\\.\\)\\|\\(Desktop/$\\)\\|\\(\\.\\(?:\\(?:\\(?:el\\|py\\)c\\)\\)$\\)\\|\\(\\.egg-info/$\\)&quot;
</code></pre></div>

<p>I mean, even <em>if</em> the regular expression above can be written in a more
efficient way (and I imagine it can), as someone working in a Lisp
environment, I'd much sooner write and work with the <code>rx</code> version.</p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2019/11/23/visual-evolution-of-emacs-config.html#visual-evolution-of-emacs-config">Visual evolution of ~/.emacs.d</a></h2>
    <p>
      Posted on 2019-11-23 14:42 +0000 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>As detailed in a blog post I wrote <a href="/2016/05/26/starting_fresh_with_gnu_emacs.html">back in
2016</a>, I first got into
using Emacs in the mid 1990s, starting with it on OS/2 and then moving over
to GNU/Linux. It's been my often-used and much-loved development environment
for most of those years (I even have a couple of packages that are part of
Emacs itself).</p>
<p>For most of that time my configuration was a single <code>~/.emacs</code> file, which
was around 1,000 lines in length (including comments and whitespace). It'd
grown over the years, having special configuration sections for versions of
Emacs I didn't use any more, and operating systems I didn't work on any more
(yes, really, there were things in there specific to MS-DOS, for example).
On top of that I always hand-installed packages I used -- Emacs' package
management system having turned up long after I first got into using Emacs.</p>
<p>Then, in early 2016, I decided to nuke the whole thing and start from
scratch. As mentioned above, the start of this <a href="/2016/05/26/starting_fresh_with_gnu_emacs.html">is detailed in an older
post</a>. Another big round of
changes <a href="/2017/04/01/another_revamp_of_my_emacs_config.html">happened round a year
later</a> -- which included
the birth of <a href="http://blog.davep.org/delpa/">delpa</a> to manage my personal
packages. A couple or so months later there was <a href="/2017/07/13/more_revamping_of_my_emacs_config.html">one last big round of
changes</a>, mostly killing
off my enthusiastic embracing of
<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Easy-Customization.html#Easy-Customization"><code>customize</code></a>
and instead going back to hand-set settings, only this time done via
<a href="https://github.com/jwiegley/use-package"><code>use-package</code></a>.</p>
<p>The full history of this <a href="https://github.com/davep/.emacs.d">can be found over on
GitHub</a>, starting with the first "throw
everything away and start again" process and all the steps between then and
where my Emacs configuration is now.</p>
<p>Which brings me to the fun part of this blog post. Earlier this week I
stumbled on <a href="https://gource.io/">Gource</a>. It's a tool that's primarily
designed to visualise changes in repositories, although it can be used to
visualise anything that has a tree structure and changes over time (this
week I produced a video of the growth of my employer's electronic lab
notebook by hooking up the <a href="https://www.benchling.com/">Benchling</a> API with
Gource, for example). So I got curious. What did it look like as I reworked
and tweaked and changed and tinkered with my Emacs configuration?</p>
<p>This is what it looked like:</p>
<p><a href="https://www.youtube.com/watch?v=bH4G80aZgsM"><img alt="Visit YouTube" src="https://img.youtube.com/vi/bH4G80aZgsM/0.jpg"></a></p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2019/10/19/pypath-el.html#pypath-el">pypath.el -- A little Emacs hack to help with Django</a></h2>
    <p>
      Posted on 2019-10-19 10:35 +0100 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/python.html">Python</a>,              <a href="https://blog.davep.org/tag/django.html">Django</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>
    </p>
  </header>
  <div>
      <div><p>One of the things I really like about coding with Emacs is how I can easily
identify a repeated task and turn it into a command in my environment,
saving me a load of work down the line.</p>
<p><a href="https://github.com/davep/pypath.el"><code>pypath.el</code></a> is one such example.</p>
<p>In my day job I write a lot of Django code. As part of that, I write a good
number of unit tests too. Sometimes I'll write the tests as I'm writing the
code they test, other times I'm writing them afterwards; it all really
depends on where my head's at and how the code is flowing.</p>
<p>When I'm writing those tests, I often want to test them as I go. Given that
starting up a test session can take a while, and given that running all the
tests in the system can take a while, it's really handy if I can run that
single test I'm working on.</p>
<p>This is easy enough with Django. In my work environment it's normally
something like:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>./manage.py<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span><span class="m">2</span><span class="w"> </span>app.test.some.sub.module.TestClass.test_method
</code></pre></div>

<p>Only... typing out the:</p>
<div class="highlight"><pre><span></span><code><span class="n">app</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">some</span><span class="o">.</span><span class="n">sub</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">TestClass</span><span class="o">.</span><span class="n">test_method</span>
</code></pre></div>

<p>part is a bit of a pain. Sure, once you've typed it the once you can use
your shell of choice (mine being <a href="https://fishshell.com/">fish</a> and on
occasion
<a href="https://www.gnu.org/software/emacs/manual/html_mono/eshell.html">eshell</a>)
to recall it from history, but typing it out the first time is the annoying
part.</p>
<p>So this was the point where I took 1/2 hour or so to code up
<a href="https://github.com/davep/pypath.el"><code>pypath.el</code></a> to solve the problem for
me. It gives me two commands:</p>
<ul>
<li><code>pypath</code>: which simply places the dotted path of the <a href="http://doc.endlessparentheses.com/Fun/python-info-current-defun.html">current
  "defun"</a>,
  within the context of being part of a Django system, into the clipboard
  buffer.</li>
<li><code>pypath-django-test</code>: which works similar to the above but places the
  whole Django testing command into the clipboard.</li>
</ul>
<p>With the above, I can work on a test, hit the latter command above, flip to
my command line, paste and I'm running the test.</p>
<p>Of course, I'm sure there's plenty of other handy ways to do this. Doubtless
there's work environments where the test can be run right there, in the edit
buffer, without flipping away, and which takes into account the fact that
there's a pipenv-managed virtual environment involved, etc. If there is,
that's great, but I don't think it'd work with how I work.</p>
<p>And that's one of the things I really love about Emacs, and why it's still
my work environment after almost 25 years of on and off use: with very
little work on my part I can create a couple of commands that work exactly
how I need them to. While it's great to create <a href="https://melpa.org/">generally-useful code for
Emacs that lots of people benefit from</a>, sometimes the
real value is that <a href="https://blog.davep.org/delpa/">you can code up your own particular quirk and just get
on with stuff</a>.</p>
<p>To conclude: this post isn't to show off <code>pypath.el</code>; really this post is to
sing the praises of Emacs and why it still works so well for me after all
these years.</p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2017/07/13/more_revamping_of_my_emacs_config.html#more_revamping_of_my_emacs_config">More revamping of my Emacs config</a></h2>
    <p>
      Posted on 2017-07-13 15:25 +0100 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/programming.html">programming</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>
    </p>
  </header>
  <div>
      <div><p>I've been pretty quiet on here since I last wrote about how I'd done a
further revamp of my Emacs config, so I thought that subject would be a good
reason to write another blog post.</p>
<p>It'll be a mostly short one, and one to muse over something that's been
bugging me for a while now: my decision to lean heavily on <code>customize</code> to
set all sorts of settings.</p>
<p>Initially,
<a href="/2016/05/26/starting_fresh_with_gnu_emacs.html">when I nuked my original config over a year ago</a>,
it seemed to make a lot of sense. Let all the tweaks and set values "hide"
in a file of their own and try and keep the hand-edited config files as
small and as clean as possible. Recently though I've got to thinking that
this obscures too much, hides too much detail, and removes the ability to
actually document what I'm doing and why. It also does make it tricky to
adapt some settings to different platforms or even environments on a single
platform.</p>
<p>Another problem I've run into is
this:
<a href="/2017/04/01/another_revamp_of_my_emacs_config.html">when I made the second round of changes</a> and
decided to lean heavily
on <a href="https://github.com/jwiegley/use-package"><code>use-package</code></a>, I soon ran into
the minor issue of some packages not making sense, or even being needed, on
some platforms (stuff that's useful on my macOS machines isn't always useful
on my Windows machines, that sort of thing). While <code>use-package</code> can handle
this easily thanks to the <code>:if</code> keyword, I'm still left with the fact that
<code>package-selected-packages</code> still gets populated.</p>
<p>Having <code>package-selected-packages</code> contain a list of installed packages
likely makes sense if you're using just the Emacs package system and you're
not doing the installing with <code>use-package</code> and <code>:ensure</code>. But with
<code>use-package</code> and <code>:ensure</code> I feel like I've got far more control over
things and can adapt what gets installed when depending on which Emacs I'm
running where.</p>
<p>But, because I'm syncing my <code>~/.emacs.d/.custom.el</code> to all my machines too, any
<code>use-package</code> that has a <code>:if</code> to not bother using a package has little
effect because the package still ends up being listed/loaded/seen as part of
the installation.</p>
<p>Ideally, I think, I'd like to be able to have <code>package-selected-packages</code>
held in its own file, or I'd only ever use <code>~/.emacs.d/.custom.el</code> for local
stuff (and so stop syncing it).</p>
<p>Starting today I'm going about a process of moving as much as I can out of
<code>~/.emacs.d/.custom.el</code> and into hand-edited files. In some respects I guess
I am going back to how I used to manage Emacs configuration, but this time
it's not a massive monolithic file-of-Lisp, it's neatly broken down into
sensible sections and it's also biased towards a "grab and config this
package" approach.</p>
<p>Meanwhile, I've not seen any good discussions online about <code>customize</code> vs
"hand-edit", which strikes me as a little odd as it feels like the perfect
"religious issue" for people to have endless disagreements over. I guess,
over the next couple or so weeks, I'll find out if switching back was a good
idea.</p></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://blog.davep.org/2017/04/01/another_revamp_of_my_emacs_config.html#another_revamp_of_my_emacs_config">Another revamp of my emacs config</a></h2>
    <p>
      Posted on 2017-04-01 10:02 +0100 in <a href="https://blog.davep.org/category/emacs.html">Emacs</a>

          &#8226; Tagged with
              <a href="https://blog.davep.org/tag/emacs.html">Emacs</a>,              <a href="https://blog.davep.org/tag/lisp.html">Lisp</a>,              <a href="https://blog.davep.org/tag/emacs-lisp.html">Emacs Lisp</a>,              <a href="https://blog.davep.org/tag/programming.html">Programming</a>
    </p>
  </header>
  <div>
      <div><p>Just under a year ago I decided to
<a href="/2016/05/26/starting_fresh_with_gnu_emacs.html">totally rewrite my GNU emacs config</a>.
As I wrote at the time, it'd been following me around all sorts of machines
since the early 1990s, starting life on an OS/2 Warp machine and travelling
via MS-DOS, GNU/Linux, Windows and, these days, macOS.</p>
<p>The changes I made last year have served me really well, but there were two
related issues with it that bothered me a little: the fact that I was
maintaining a local library of elisp code in the repository and, worse
still, I was storing the packages I'd installed from elpa and melpa in the
repository as well.</p>
<p>While this did mean it was pretty easy for me to start up a new installation
of emacs on a machine -- all I had to do was clone the repo and run up emacs
-- I wasn't happy with the duplication involved. I didn't like holding code
in my <code>.emacs.d</code> repo that was already held in package archives.</p>
<p>The solution I saw was in two parts:</p>
<ol>
<li>Get some of my code, that might be useful to others, into melpa.</li>
<li>Somehow sort my own package archive for my personal code.</li>
</ol>
<p></p>

<p>Over the past week or so I've worked on this approach. It initially started
with me tackling item 1 above: I tidied up and
submitted
<a href="https://github.com/davep/obfusurl.el"><code>obfusurl.el</code></a>,
<a href="https://github.com/davep/protocols.el"><code>protocols.el</code></a>,
<a href="https://github.com/davep/services.el"><code>services.el</code></a>,
<a href="https://github.com/davep/thinks.el"><code>thinks.el</code></a> and
<a href="https://github.com/davep/uptimes.el"><code>uptimes.el</code></a>. This was a really
helpful process in that it allowed me to brush up on my elisp and emacs
knowledge. It's a good 15+ years since I last wrote any significant elisp
code and things have moved on a little in that time.</p>
<p>Having done that I'd managed to move a handful of my own packages out of my
local library of code, and so out of my <code>.emacs.d</code> repo, but it left me with
the problem of what to do with the rest of it.</p>
<p>That's when I discovered <code>package-x</code> and:</p>
<div class="highlight"><pre><span></span><code><span class="p">,</span><span class="o">----</span><span class="p">[</span><span class="w"> </span><span class="n">C</span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">package</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">buffer</span><span class="w"> </span><span class="n">RET</span><span class="w"> </span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">package</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">buffer</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">interactive</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">Lisp</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span>
<span class="o">|</span><span class="w"> </span><span class="err"></span><span class="n">package</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">el</span><span class="err"></span><span class="o">.</span>
<span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">package</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">buffer</span><span class="p">)</span>
<span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Upload</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">Emacs</span><span class="w"> </span><span class="n">Lisp</span><span class="w"> </span><span class="n">package</span><span class="o">.</span>
<span class="o">|</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="err"></span><span class="n">package</span><span class="o">-</span><span class="n">archive</span><span class="o">-</span><span class="n">upload</span><span class="o">-</span><span class="n">base</span><span class="err"></span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">upload</span>
<span class="o">|</span><span class="w"> </span><span class="n">destination</span><span class="p">,</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">one</span><span class="o">.</span>
<span class="err">`</span><span class="o">----</span>
</code></pre></div>

<p>(plus <code>package-upload-file</code> too, of course). This meant I could, in effect,
start my own personal package archive and look at tackling issue 2 above.</p>
<p>This did give me one small problem though: how and where would I host the
archive? I did consider hosting it on a DigitalOcean droplet, but that felt
a little like overkill for something so simple. And then I
realised: <a href="https://pages.github.com/">GitHub Pages</a>! All I needed to do was
keep the package archive in its own repo (which I would have done anyway)
and then make the whole repo the source for a GitHub Pages site. A quick
test later and... it worked!</p>
<p>So, by this point, I'd farmed some of my code off to melpa, and now had the
rest of it in "delpa" (which I'd called my personal archive). I could now
use the emacs package management system to install third party packages and
also my own.</p>
<p>But I was still left with one issue: I was still holding the installed
packages inside my <code>.emacs.d</code> repo by way of ensuring that all machines were
in sync in terms of what was installed. Now I needed to work out how to
solve that.</p>
<p>Around this time, as luck would have
it, <a href="https://github.com/tarsius">@tarsius</a>
had
<a href="https://github.com/davep/boxquote.el/pull/1#issuecomment-288462491">suggested I look at</a> a
package called <a href="https://github.com/jwiegley/use-package"><code>use-package</code></a>
by <a href="https://github.com/jwiegley">@jwiegley</a>. This was the bit I was missing.</p>
<p>With <code>use-package</code> I would be able to declare which packages I needed, how
they'd be installed and, most important of all, it could be set to handle
the fact that the package wasn't even installed. If a package is requested
and there is no local install <code>use-package</code> is smart enough to get the emacs
package system to install it.</p>
<p>So, given that, all I need to do was <a href="https://github.com/davep/.emacs.d/blob/1fa67c2895f345098057654f6acb3b57a77f1194/startup/davep-packages.el">create a startup file that would
declare the packages I use</a> and
I'd have a setup that should, once I'd cloned <code>.emacs.d</code>, self-install.</p>
<p>Except... yeah, one more issue. <code>use-package</code> isn't part of GNU emacs yet so
I'd need a method of getting it to auto-install so it could then handle
everything else. As it was that was as easy as adding this to the start of
my <a href="https://github.com/davep/.emacs.d/blob/master/init.el"><code>init.el</code></a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="c1">;; Make sure the package system is up and running early on.</span>
<span class="p">(</span><span class="nb">require</span><span class="w"> </span><span class="ss">&#39;package</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-to-list</span><span class="w"> </span><span class="ss">&#39;package-archives</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;melpa&quot;</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s">&quot;http://melpa.org/packages/&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">add-to-list</span><span class="w"> </span><span class="ss">&#39;package-archives</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;delpa&quot;</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s">&quot;http://blog.davep.org/delpa/&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>

<span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="c1">;; Bootstrap `use-package&#39;</span>
<span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nv">package-installed-p</span><span class="w"> </span><span class="ss">&#39;use-package</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nv">package-install</span><span class="w"> </span><span class="ss">&#39;use-package</span><span class="p">))</span>
</code></pre></div>

<p>With that in place I was able to nuke all my config on a machine, clone a
fresh copy of <code>.emacs.d</code> (having now ceased tracking and storing the
installed packages in that repo), run up emacs, wait a few moments and then
find that everything was installed and ready to use.</p>
<p>Perfect!</p>
<p>My <a href="https://github.com/davep/.emacs.d"><code>.emacs.d</code></a> is now a lot smaller than
it was before and, I think, even easier to maintain. Right now I think I'm
very close to the ideal emacs config that I wanted to create when I did the
complete rewrite a year ago.</p></div>
  </div>
</article>

  <div class="pagination">
  </div>



<footer>
<p>&copy; 2015-2023 Dave Pearson</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://blog.davep.org/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " blog.davep.org ",
  "url" : "https://blog.davep.org",
  "image": "/static/davep.jpeg",
  "description": ""
}
</script>
</body>
</html>