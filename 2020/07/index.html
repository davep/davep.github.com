<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="blogmore v0.12.0">
    <title>Posts from July 2020 - davep</title>
    
    <link rel="icon" href="/icons/favicon.ico">
    
    
    <!-- Shortcut icon for backward compatibility -->
    <link rel="shortcut icon" href="/favicon.ico">
    <!-- Favicon alternatives -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-touch-icon-167.png">
    <!-- Android/Chrome -->
    <link rel="manifest" href="/icons/site.webmanifest">
    <!-- Windows/Edge -->
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    
    <link rel="stylesheet" href="/static/fontawesome.css">
    
    <link rel="stylesheet" href="/static/styles.min.css">
    
    
    <link rel="alternate" type="application/rss+xml" title="davep - RSS Feed" href="https://blog.davep.org/feed.xml">
    <link rel="alternate" type="application/atom+xml" title="davep - Atom Feed" href="https://blog.davep.org/feeds/all.atom.xml">
    
    
    
    <meta name="author" content="Dave Pearson">
    
    
    
<meta property="og:title" content="Posts from July 2020 - davep">

<meta name="description" content="Dave Pearson&#39;s personal blog">
<meta property="og:description" content="Dave Pearson&#39;s personal blog">
<meta name="twitter:description" content="Dave Pearson&#39;s personal blog">


<meta name="keywords" content="Emacs, Python, Programming, Terminal, Textual">


    <script src="/static/theme.js"></script>
    
</head>
<body>
    <div class="site-container">
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    
                    <div class="sidebar-logo">
                        <a href="/">
                            <img src="/logo.jpeg" alt="davep">
                        </a>
                    </div>
                    

                    <div class="sidebar-title">
                        <h1><a href="/">davep</a></h1>
                        
                        <p class="sidebar-subtitle">Code and stuff</p>
                        
                    </div>
                </div>

                
                <div class="sidebar-pages">
                    <ul class="sidebar-links">
                        
                        <li><a href="/about.html">About</a></li>
                        
                        <li><a href="/dotfiles.html">Dot Files</a></li>
                        
                    </ul>
                </div>
                

                
                <section class="sidebar-section">
                    <h2>Links</h2>
                    <ul class="sidebar-links">
                        
                        <li><a href="https://davep.at/" target="_blank" rel="noopener noreferrer">davep@</a></li>
                        
                        <li><a href="https://raindrop.io/davep/public-46742255/sort=-created&amp;perpage=30&amp;page=0" target="_blank" rel="noopener noreferrer">Bookmarks</a></li>
                        
                        <li><a href="https://seenbydavep.blogspot.com/" target="_blank" rel="noopener noreferrer">Photoblog</a></li>
                        
                        <li><a href="https://elisp.dev/" target="_blank" rel="noopener noreferrer">Emacs Packages</a></li>
                        
                        <li><a href="https://pypi.org/user/davepearson/" target="_blank" rel="noopener noreferrer">Python Packages</a></li>
                        
                    </ul>
                </section>
                

                
                <section class="sidebar-section">
                    <h2>Social</h2>
                    <div class="sidebar-socials">
                        
                        <a href="https://www.flickr.com/photos/davepearson/" title="flickr" aria-label="flickr" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-flickr"></i>
                        </a>
                        
                        <a href="https://github.com/davep" title="github" aria-label="github" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-github"></i>
                        </a>
                        
                        <a href="https://www.last.fm/user/davepdotorg" title="lastfm" aria-label="lastfm" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-lastfm"></i>
                        </a>
                        
                        <a href="https://fosstodon.org/@davep" title="mastodon" aria-label="mastodon" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-mastodon"></i>
                        </a>
                        
                        <a href="https://www.npmjs.com/~davep.org" title="npm" aria-label="npm" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-npm"></i>
                        </a>
                        
                        <a href="https://steamcommunity.com/id/davepdotorg" title="steam" aria-label="steam" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-steam"></i>
                        </a>
                        
                        <a href="https://www.youtube.com/user/daveporg" title="youtube" aria-label="youtube" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-youtube"></i>
                        </a>
                        
                    </div>
                </section>
                
            </div>
        </aside>

        <div class="main-wrapper">
            <header>
                <nav>
                    <ul>
                        <li><a href="/categories.html">Categories</a></li>
                        <li><a href="/tags.html">Tags</a></li>
                        <li><a href="/archive.html">Archive</a></li>
                        
                        <li><a href="/search.html">Search</a></li>
                        
                        
                        <li><a href="/feed.xml" title="Subscribe via RSS feed">RSS</a></li>
                        <li><a href="/feeds/all.atom.xml" title="Subscribe via Atom feed">Atom</a></li>
                        
                        <li>
                            <button class="theme-toggle" type="button" aria-label="Toggle theme">
                                <span class="icon light-icon">‚òÄÔ∏è</span>
                                <span class="icon dark-icon">üåô</span>
                                <span class="theme-label">Theme</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </header>

            <main>
                
<div class="archive">
    <h1>Posts from July 2020</h1>
    
    
    
    
    
    <article class="post-summary">
        <h2><a href="/2020/07/18/swift-til-12.html">Swift TIL 12</a></h2>
        
        <time datetime="2020-07-18T10:16:00+01:00"><a href="/2020/">2020</a>-<a href="/2020/07/">07</a>-<a href="/2020/07/18/">18</a> 10:16:00 UTC+01:00</time>
        
        <div class="reading-time">2 min read</div>
        
        <div class="category">
            <a href="/category/til.html" class="category-link">TIL</a>
        </div>
        
        <div class="post-content">
            <p>First a small aside: To be honest, the <code>T</code> part of <code>TIL</code> is getting to be
less and less true with this series of posts, but the posts themselves serve
a useful purpose for me. As I've been reading the book I'm working through,
I've also been making notes on my iPad in the <a href="https://apps.apple.com/us/app/notes/id1110145109" rel="noopener noreferrer" target="_blank">Apple Notes
application</a>. I'm not
really convinced that that's the best final location for such notes, so
early on I made an extra step in keeping track of what I'm doing and trying
to reinforce what I'm learning: transfer the notes into
<a href="https://orgmode.org/" rel="noopener noreferrer" target="_blank">Org-Mode</a> documents in my notebook repository.</p>
<p>This repository contains lots of Org-Mode files, broken down into subject
directories, that hang on to longer-form information I want to keep track of
regarding software development and general operating system use. I'm sure
you know the sort of thing, the things where you know you know them but you
can't always retain all the detail -- so having the detail where you know
you'll find it is useful.</p>
<p>So I've made that part of the process: read book, find thing worth noting,
note in Apple Notes, a wee while later re-read and test out by writing
sample code and transfer to the Org-Mode notebook. During that latter step I
sometimes also write up something that I really liked or found interesting
here to further reinforce the learning process.</p>
<p>The "TIL" I wanted to note quickly today is how happy I was to see that
Swift has something that's a reasonably recent addition to Emacs Lisp:
conditional binding. Skipping off into Emacs Lisp for a moment, it would be
very common for me to find myself writing something like this (this actually
happens in all languages really):</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">foo</span><span class="w"> </span><span class="p">(</span><span class="nv">get-something-from-elsewhere</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="nv">foo</span>
<span class="w">    </span><span class="p">(</span><span class="nv">do-something-with</span><span class="w"> </span><span class="nv">foo</span><span class="p">)))</span>
</code></pre></div>

<p>Quite simply: I'd get a value from elsewhere, that value could possibly be
<code>nil</code> to mark that there was a failure to get a value, but that failure
wasn't in any way fatal or even a problem worthy of note: I just needed to
skip along. But that binding followed by the test was always a little
jarring. And then, <a href="https://endlessparentheses.com/new-in-emacs-25-1-more-flow-control-macros.html" rel="noopener noreferrer" target="_blank">back in
25.1</a>,
<code>if-let</code> and <code>when-let</code> got added (of course, this being Lisp, <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Macros.html#Macros" rel="noopener noreferrer" target="_blank">it would
have been very simple to add them
anyway</a>),
and it was easier to <a href="https://github.com/davep/pinboard.el/blob/d426f9d2ebec5f907c8a89d6b38ccbcb13750d4f/pinboard.el#L308" rel="noopener noreferrer" target="_blank">write the code so it looked just a little
nicer</a>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nv">when-let</span><span class="w"> </span><span class="p">((</span><span class="nv">foo</span><span class="w"> </span><span class="p">(</span><span class="nv">get-something-from-elsewhere</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nv">do-something-with</span><span class="w"> </span><span class="nv">foo</span><span class="p">))</span>
</code></pre></div>

<p>It's a small difference, but I find it a pleasing one.</p>
<p>So of course I was pleased to find that Swift has something similar with
<code>if</code> and
<a href="https://developer.apple.com/documentation/swift/optional" rel="noopener noreferrer" target="_blank"><code>Optional</code></a>
values, where you can write something like:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getSomethingFromElsewhere</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Do something with foo but only if it&#39;s not nil</span>
<span class="p">}</span>
</code></pre></div>

<p>Which means you can do things like this (not that I'd really do things like
this, but it was a handy test on the command line):</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nf">oddRand</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Int</span><span class="p">?</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">Int</span><span class="p">.</span><span class="n">random</span><span class="p">(</span><span class="w"> </span><span class="k">in</span><span class="p">:</span><span class="w"> </span><span class="mf">0.</span><span class="p">..</span><span class="mi">99</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">n</span>
<span class="p">}</span>

<span class="k">for</span><span class="w"> </span><span class="kc">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">..</span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">oddRand</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Nope&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>As usual... of course that's horrible code, it was just thrown together to
test/experience the language feature on the command line.</p>
<p>I like it though. I figure <a href="https://clojuredocs.org/clojure.core/when-let" rel="noopener noreferrer" target="_blank">all the best languages have conditional
binding</a>. ;-)</p>
        </div>
        
        <div class="tags">
            
            <a href="/tag/swift.html" class="tag">Swift</a>
            
            <a href="/tag/apple.html" class="tag">Apple</a>
            
        </div>
        
    </article>
    
    <article class="post-summary">
        <h2><a href="/2020/07/11/swift-til-11.html">Swift TIL 11</a></h2>
        
        <time datetime="2020-07-11T21:34:00+01:00"><a href="/2020/">2020</a>-<a href="/2020/07/">07</a>-<a href="/2020/07/11/">11</a> 21:34:00 UTC+01:00</time>
        
        <div class="reading-time">2 min read</div>
        
        <div class="category">
            <a href="/category/til.html" class="category-link">TIL</a>
        </div>
        
        <div class="post-content">
            <p>This is one of those things, especially this little play to help appreciate
the feature, that I'm filing under "kinda cool, but I am <em>never</em> doing this
in production".</p>
<p>So Swift has operator overriding, and then some. Moreover, operators are, in
effect, functions, just with some extra syntax support. None of this is new
to me, I've worked in and with other languages that have this ability,
expect... I don't ever recall working in a language that, at the time I did,
supported creating brand new operators (okay, fine, Lisp is a bit of an
outlier here and there's all sorts of fun conversations to be had there --
but still, let's stick with more "conventional" syntax here). Support always
seemed to be about extending the ability of an existing operator.</p>
<p>Swift though... yeah, you get to pick from a huge character space when it
comes to creating operators.</p>
<p>Which got me thinking... How cool would it be to have a prefix operator that
turns a floating point number into a currency-friendly number (you know, the
sort of number type that can be used for currency-friendly calculations).</p>
<p>Swift has the
<a href="https://developer.apple.com/documentation/foundation/decimal" rel="noopener noreferrer" target="_blank"><code>decimal</code></a>
type which, at first glance anyway, looks to be a sensible candidate; even
if it isn't (and, really, how to actually sensibly handle currency is a
whole series of blog posts in their own right, that I have no wish to write
myself because such things are a previous working life for me, and other
people have doubtless done a very comprehensive job elsewhere over the
years) it will serve as a good stand-in for the little bit of horror I'm
going to write next.</p>
<p>So... Let's say we want to use <code>¬£</code> as a prefix operator to say "see this
number? make it a <code>decimal</code>", we could do something as simple as this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">import</span><span class="w"> </span><span class="nc">Foundation</span>

<span class="kr">prefix</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="err">¬£</span>
<span class="kr">prefix</span><span class="w"> </span><span class="kd">func</span><span class="w"> </span><span class="err">¬£</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Decimal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Decimal</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="err">¬£</span><span class="mf">1.20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">¬£</span><span class="mf">0.75</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">¬£</span><span class="mf">0.01</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<p>Horrifically and delightfully, it works:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>swift<span class="w"> </span>run
<span class="o">[</span><span class="m">3</span>/3<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>opover
<span class="m">1</span>.96
</code></pre></div>

<p>I know, I know, I feel bad for even trying. But it's also kinda cool that
the language has this.</p>
<p>It gets better though...</p>
<p>While reading up on what characters can and can't be used as operators, one
thing that stood out was the fact that, more or less, any character that
isn't a valid identifier can be used as an operator. So... hang on, we can
use "emoji" as identifiers?</p>
<p>Like this?</p>
<div class="highlight"><pre><span></span><code><span class="kd">import</span><span class="w"> </span><span class="nc">Foundation</span>

<span class="kr">prefix</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="err">¬£</span>
<span class="kr">prefix</span><span class="w"> </span><span class="kd">func</span><span class="w"> </span><span class="err">¬£</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Decimal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">Decimal</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="err">üíµ</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">¬£</span><span class="mf">1.20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">¬£</span><span class="mf">0.75</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">¬£</span><span class="mf">0.01</span>

<span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="err">üíµ</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<p>Why yes. Yes we can. üòà</p>
        </div>
        
        <div class="tags">
            
            <a href="/tag/swift.html" class="tag">Swift</a>
            
            <a href="/tag/apple.html" class="tag">Apple</a>
            
        </div>
        
    </article>
    
    <article class="post-summary">
        <h2><a href="/2020/07/10/when-the-man-page-fibs.html">When the man page fibs</a></h2>
        
        <time datetime="2020-07-10T20:58:00+01:00"><a href="/2020/">2020</a>-<a href="/2020/07/">07</a>-<a href="/2020/07/10/">10</a> 20:58:00 UTC+01:00</time>
        
        <div class="reading-time">3 min read</div>
        
        <div class="category">
            <a href="/category/coding.html" class="category-link">Coding</a>
        </div>
        
        <div class="post-content">
            <p>Earlier this week something in my development environment, relating to
<a href="https://brew.sh/" rel="noopener noreferrer" target="_blank">Homebrew</a>, Python,
<a href="https://github.com/pyenv/pyenv" rel="noopener noreferrer" target="_blank">pyenv</a> and
<a href="https://pipenv.pypa.io/en/latest/" rel="noopener noreferrer" target="_blank">pipenv</a>, got updated and broke a handful
of repositories. Not in a way that I couldn't recover from, just in a way
that was annoying, got in the way of my workflow, and needed attention.
<em>(note to self: how I set up for Python/Django development on a machine
might be a good post in the future)</em></p>
<p>Once I was sure what the fix was (pretty much: nuke the virtual environment
and recreate it with <code>pipenv</code>, being very explicit about the version of
Python to use) the next step was to figure out how many repositories were
affected; not all were and there wasn't an obvious pattern to it. What was
obvious was that the problem came down to <code>python</code> in the <code>.venv</code> directory
pointing to a binary that didn't exist any more.</p>
<p><img alt="Screenshot 2020-07-10 at 20.21.15.png" src="/attachments/2020/07/10/Screenshot 2020-07-10 at 20.21.15.png" /></p>
<p>So... tracking down problematic repositories would be simple enough, just
look for every instance of <code>.venv/bin/python</code> and be sure it points to
something rather than nothing; if it points to nothing I need to remake the
virtual environment.</p>
<p>I quickly knocked up a script that was based around looking over the results
of a <code>find</code>, and initially decided to use <code>file</code> to perform the test on
<code>python</code>. It seemed to make sense, as I wrote the script I checked the <code>man</code>
page for <code>file(1)</code> on macOS and sure enough, this exists:</p>
<blockquote>
<p>-E On filesystem errors (file not found etc), instead of handling the error as regular output as POSIX mandates and keep going, issue an error message and exit.</p>
</blockquote>
<p>Given that <code>file</code> dereferences links by default, that should get me an error
for a broken link, right? Bit hacky I guess, but it was the first thing that
came to mind for a quick bit of scripting and would do the trick. Only...</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>file<span class="w"> </span>-E<span class="w"> </span>does-not-exist
file:<span class="w"> </span>invalid<span class="w"> </span>option<span class="w"> </span>--<span class="w"> </span>E
Usage:<span class="w"> </span>file<span class="w"> </span><span class="o">[</span>bcCdEhikLlNnprsvzZ0<span class="o">]</span><span class="w"> </span><span class="o">[</span>-e<span class="w"> </span>test<span class="o">]</span><span class="w"> </span><span class="o">[</span>-f<span class="w"> </span>namefile<span class="o">]</span><span class="w"> </span><span class="o">[</span>-F<span class="w"> </span>separator<span class="o">]</span><span class="w"> </span><span class="o">[</span>-m<span class="w"> </span>magicfiles<span class="o">]</span><span class="w"> </span><span class="o">[</span>-M<span class="w"> </span>magicfiles<span class="o">]</span><span class="w"> </span>file...
<span class="w">       </span>file<span class="w"> </span>-C<span class="w"> </span>-m<span class="w"> </span>magicfiles
Try<span class="w"> </span><span class="sb">`</span>file<span class="w"> </span>--help<span class="err">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>information.
</code></pre></div>

<p><a href="https://www.destroyallsoftware.com/talks/wat" rel="noopener noreferrer" target="_blank">Wat</a>?!? But it's right there! It says so in the manual! <code>-E</code> is documented right in the manual page! And yet it's not in the valid switch list as put out by the command, <em>and</em> it's an <code>invalid option</code>. The hell?</p>
<p>So I go back and look at the <code>man</code> page again and then I notice it isn't in
the list of switches in the synopsis.</p>
<blockquote>
<p>SYNOPSIS<br />
    file [-bcdDhiIkLnNprsvz] [--extension] [--mime-encoding] [--mime-type] [-f namefile] [-m magicfiles] [-P name=value] [-M magicfiles] file<br />
    file -C [-m magicfiles]<br />
    file [--help]  </p>
</blockquote>
<p>I then did the obvious tests. Did I have <code>file</code> aliased in some way? No. Was
some other thing that works and acts like <code>file</code> in my path? No. Was I
absolutely 100% using <code>/usr/bin/file</code>? Yes.</p>
<p>Long story short: it seems the <code>man</code> page for <code>file</code>, on macOS, fibs about
what switches it supports; it says that <code>-E</code> is a valid option, but it's not
there.</p>
<p>What's even odder is the man page says it documents v5.04 of the command,
but <code>--version</code> reports v5.37. Meanwhile, if I check on a GNU/Linux box I
have access to, it does support <code>-E</code>, reports it in the switches, documents
it in the <code>man</code> page (in both the synopsis and in the main body of the page)
and it is v5.25 (and so is its man page).</p>
<p>So that was something like 20 minutes lost to a very small problem, for
which there was no real solution, but was time that had to be spent to get
to the bottom of it.</p>
<p>In the end I went with what I probably should have gone with in the first
place: <code>stat -L</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>venv<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span>.venv<span class="k">)</span>
<span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>stat<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$venv</span><span class="s2">/bin/python&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="w">    </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$venv</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>
</code></pre></div>

<p>And now I have that script in my <code>~/bin</code> directory, ready for the next time
Homebrew and friends conspire to throw my day off for a while.</p>
        </div>
        
        <div class="tags">
            
            <a href="/tag/homebrew.html" class="tag">homebrew</a>
            
            <a href="/tag/macos.html" class="tag">macOS</a>
            
            <a href="/tag/unix.html" class="tag">Unix</a>
            
            <a href="/tag/python.html" class="tag">Python</a>
            
        </div>
        
    </article>
    
    <article class="post-summary">
        <h2><a href="/2020/07/09/helping-myself-change-the-default-git-branch.html">Helping myself change the default git branch</a></h2>
        
        <time datetime="2020-07-09T20:17:00+01:00"><a href="/2020/">2020</a>-<a href="/2020/07/">07</a>-<a href="/2020/07/09/">09</a> 20:17:00 UTC+01:00</time>
        
        <div class="reading-time">2 min read</div>
        
        <div class="category">
            <a href="/category/coding.html" class="category-link">Coding</a>
        </div>
        
        <div class="post-content">
            <p>This is something I've being meaning to do for a couple or so years now, and
unsurprisingly it's bubbled up again recently: the business of swapping the
name of the <code>master</code> branch in <code>git</code> out for something better.</p>
<p>Because it's one of those jobs that's simultaneously simple and also
laborious, I kept putting it off. Changing up the local configuration so
that <code>main</code> (or whatever name you prefer) is used "out of the box" <a href="https://leigh.net.au/writing/git-init-main/" rel="noopener noreferrer" target="_blank">is
simple enough</a>; the laborious
part is updating all of the repositories that live in the "forge of choice".
In my case, <a href="https://github.com/davep" rel="noopener noreferrer" target="_blank">over on GitHub</a>, I have <a href="https://github.com/davep?tab=repositories" rel="noopener noreferrer" target="_blank">getting on
for 200 repositories</a> -- 142 of
which are public (as of the time of writing). At work we use
<a href="https://gitlab.com/" rel="noopener noreferrer" target="_blank">GitLab</a> as our internal forge and I've got a
non-trivial number of repositories on there too.</p>
<p>The obvious first step to tackling this is to knock up a little tool to help
find the repos that still need swapping. That was <a href="https://github.com/davep/git-archaic" rel="noopener noreferrer" target="_blank">simple
enough</a>:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Quick and dirty tool to find repositories that still make use of a</span>
<span class="c1"># &quot;master&quot; branch. Helps with tracking down the ones that need</span>
<span class="c1"># updating/improving.</span>

<span class="k">for</span><span class="w"> </span>repo<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span>.git<span class="k">)</span>
<span class="k">do</span>
<span class="w">    </span><span class="o">(</span>
<span class="w">        </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$repo</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>master<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="w">        </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$repo</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="o">)</span>
<span class="k">done</span>

<span class="c1">### git-archaic ends here</span>
</code></pre></div>

<p>It's not meant to be clever, just something I can run when I'm in a "default
branch swapping" mood so find a repository or two to tackle. The idea being
that it uses <code>find</code> to pull out any instance of <code>.git</code> in or below the
current directory, changes to it (inside a sub-process to ensure the <code>PWD</code>
gets put back after the <code>cd</code> that happens, before the next iteration of the
loop), gets a list of the branches and, if <code>master</code> is one of them, prints
the directory name.</p>
<p>Using this, I can now slowly work through my more active repositories and
make the swap -- the idea being that if I currently have them cloned down to
my machine, they're obviously some level of "active". At some point I
imagine I could get more clever and use the APIs of the forges to look at
all the repositories I own; that's another job for another day.</p>
<p>This gives me enough to be going on with. :-)</p>
        </div>
        
        <div class="tags">
            
            <a href="/tag/git.html" class="tag">git</a>
            
        </div>
        
    </article>
    
    <article class="post-summary">
        <h2><a href="/2020/07/05/swift-til-10.html">Swift TIL 10</a></h2>
        
        <time datetime="2020-07-05T15:27:00+01:00"><a href="/2020/">2020</a>-<a href="/2020/07/">07</a>-<a href="/2020/07/05/">05</a> 15:27:00 UTC+01:00</time>
        
        <div class="reading-time">2 min read</div>
        
        <div class="category">
            <a href="/category/til.html" class="category-link">TIL</a>
        </div>
        
        <div class="post-content">
            <p>My leisurely journey into getting to know Swift by reading and then making
notes to myself in my blog continues, and this weekend I encountered
<code>defer</code>. As I was reading about Swift I did keep wondering when something
like <code>try</code> (it has <code>try</code>), <code>catch</code> (it has <code>catch</code>) and <code>finally</code> (it
doesn't have <code>finally</code>, but...) might crop up. This weekend I hit the part
of the book that covered this sort of thing.</p>
<p>Given Swift's apparent general reliance on <em>not</em> throwing errors but instead
using <code>Optional</code> and <code>nil</code> to signify issues, it sort of came as no surprise
that its approach to implementing something like <code>try</code>...<code>finally</code> is
actually divorced from <code>try</code>. I'm not sure how I feel about it yet, but
<code>defer</code> makes sense.</p>
<p>Here's an utterly useless bit of code that demonstrates how it works:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="w"> </span><span class="kc">_</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">,</span><span class="w"> </span><span class="kc">_</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Int</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Huh! We did some adding!&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;About to do the add and then return&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n2</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<p>When run, the output is this:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>swift<span class="w"> </span>run
<span class="o">[</span><span class="m">3</span>/3<span class="o">]</span><span class="w"> </span>Linking<span class="w"> </span>try-defer
About<span class="w"> </span>to<span class="w"> </span><span class="k">do</span><span class="w"> </span>the<span class="w"> </span>add<span class="w"> </span>and<span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="k">return</span>
Huh!<span class="w"> </span>We<span class="w"> </span>did<span class="w"> </span>some<span class="w"> </span>adding!
<span class="m">4</span>
</code></pre></div>

<p>A <code>defer</code> (and there can be multiple) is tied to the block that it's
declared in, and is executed when the block exits. This is, of course, going
to be really handy for things like resource-management where you don't want
to be leaking something, although I can imagine a few other uses too (none
of which are really going to be novel for someone who's coded in other
languages with similar constructs).</p>
<p>What I find interesting about this is that one or more <code>defer</code> blocks can be
declared at various locations within a block of code; this obviously makes
sense in that you might not want to be handling the tidy-up of something
you've not got around to creating yet. But there's also part of me feels
uneasy about the "exit" code being declared further up the body of code,
rather than down towards the end. On the other hand I think I do appreciate
the idea of, up front, writing "look, any time there's a GTFO in the code
that follows, this will happen" -- you're made aware pretty quickly of what
to expect.</p>
<p>Anyway, it's good to know Swift has something similar to a <code>finally</code>.</p>
        </div>
        
        <div class="tags">
            
            <a href="/tag/swift.html" class="tag">Swift</a>
            
            <a href="/tag/apple.html" class="tag">Apple</a>
            
        </div>
        
    </article>
    
    
    
    
    
    
</div>

            </main>

            <footer>
                <p>Generated with <a href="https://github.com/davep/blogmore" target="_blank" rel="noopener noreferrer">Blogmore</a></p>
            </footer>
        </div>
    </div>
</body>
</html>