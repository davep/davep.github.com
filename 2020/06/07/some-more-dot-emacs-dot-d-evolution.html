<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="blogmore v0.4.0">
    <title>Some more ~/.emacs.d evolution - davep</title>
    
    <link rel="icon" href="/icons/favicon.ico">
    
    
    <!-- Favicon alternatives -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-touch-icon-167.png">
    <!-- Android/Chrome -->
    <link rel="manifest" href="/icons/site.webmanifest">
    <!-- Windows/Edge -->
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/static/style.css">
    
    
    <link rel="alternate" type="application/rss+xml" title="davep - RSS Feed" href="https://blog.davep.org/feed.xml">
    <link rel="alternate" type="application/atom+xml" title="davep - Atom Feed" href="https://blog.davep.org/feeds/all.atom.xml">
    
    
    
    
    
    
    







<meta name="author" content="Dave Pearson">


<meta name="description" content="When I started with this version of the blog on Hashnode[^1], my plan was to try and write something at least once a week. I managed to do that as far as January this year, give or take, but then things got a little busy, the world got trickier, and... Well, you don&#39;t need me to tell you about that. Anyway, I&#39;m back to write some more and, hopefully, try and keep up with writing. I feel it&#39;ll do me good.">


<meta name="keywords" content="Emacs, Lisp, Emacs Lisp">



<meta property="og:title" content="Some more ~/.emacs.d evolution">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.davep.org/2020/06/07/some-more-dot-emacs-dot-d-evolution.html">

<meta property="og:description" content="When I started with this version of the blog on Hashnode[^1], my plan was to try and write something at least once a week. I managed to do that as far as January this year, give or take, but then things got a little busy, the world got trickier, and... Well, you don&#39;t need me to tell you about that. Anyway, I&#39;m back to write some more and, hopefully, try and keep up with writing. I feel it&#39;ll do me good.">

<meta property="og:site_name" content="davep">





<meta property="article:published_time" content="2020-06-07T16:48:00+01:00">


<meta property="article:modified_time" content="2020-06-07T16:48:00+01:00">


<meta property="article:author" content="Dave Pearson">


<meta property="article:section" content="Emacs">



<meta property="article:tag" content="Emacs">

<meta property="article:tag" content="Lisp">

<meta property="article:tag" content="Emacs Lisp">





<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Some more ~/.emacs.d evolution">

<meta name="twitter:description" content="When I started with this version of the blog on Hashnode[^1], my plan was to try and write something at least once a week. I managed to do that as far as January this year, give or take, but then things got a little busy, the world got trickier, and... Well, you don&#39;t need me to tell you about that. Anyway, I&#39;m back to write some more and, hopefully, try and keep up with writing. I feel it&#39;ll do me good.">





    <script src="/static/theme.js"></script>
    
</head>
<body>
    <div class="site-container">
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    
                    <div class="sidebar-logo">
                        <a href="/">
                            <img src="/davep.jpeg" alt="davep">
                        </a>
                    </div>
                    

                    <div class="sidebar-title">
                        <h1><a href="/">davep</a></h1>
                        
                        <p class="sidebar-subtitle">Code, Emacs, VR, Stuff...</p>
                        
                    </div>
                </div>

                
                <div class="sidebar-pages">
                    <ul class="sidebar-links">
                        
                        <li><a href="/about.html">About</a></li>
                        
                        <li><a href="/dotfiles.html">Dot Files</a></li>
                        
                    </ul>
                </div>
                

                
                <section class="sidebar-section">
                    <h2>Links</h2>
                    <ul class="sidebar-links">
                        
                        <li><a href="http://davep.at/" target="_blank" rel="noopener noreferrer">davep@</a></li>
                        
                        <li><a href="https://raindrop.io/davep/public-46742255/sort=-created&amp;perpage=30&amp;page=0" target="_blank" rel="noopener noreferrer">Bookmarks</a></li>
                        
                        <li><a href="https://seenbydavep.blogspot.com/" target="_blank" rel="noopener noreferrer">Photoblog</a></li>
                        
                        <li><a href="https://elisp.dev/" target="_blank" rel="noopener noreferrer">Emacs Packages</a></li>
                        
                        <li><a href="https://pypi.org/user/davepearson/" target="_blank" rel="noopener noreferrer">Python Packages</a></li>
                        
                    </ul>
                </section>
                

                
                <section class="sidebar-section">
                    <h2>Social</h2>
                    <div class="sidebar-socials">
                        
                        <a href="https://github.com/davep" title="github" aria-label="github" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-github"></i>
                        </a>
                        
                        <a href="https://fosstodon.org/@davep" title="mastodon" aria-label="mastodon" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-mastodon"></i>
                        </a>
                        
                        <a href="https://www.flickr.com/photos/davepearson/" title="flickr" aria-label="flickr" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-flickr"></i>
                        </a>
                        
                        <a href="https://www.last.fm/user/davepdotorg" title="lastfm" aria-label="lastfm" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-lastfm"></i>
                        </a>
                        
                        <a href="https://www.npmjs.com/~davep.org" title="npm" aria-label="npm" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-npm"></i>
                        </a>
                        
                        <a href="https://www.youtube.com/user/daveporg" title="youtube" aria-label="youtube" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-youtube"></i>
                        </a>
                        
                        <a href="https://steamcommunity.com/id/davepdotorg" title="steam" aria-label="steam" target="_blank" rel="noopener noreferrer">
                            <i class="fa-brands fa-steam"></i>
                        </a>
                        
                    </div>
                </section>
                
            </div>
        </aside>

        <div class="main-wrapper">
            <header>
                <nav>
                    <ul>
                        <li><a href="/categories.html">Categories</a></li>
                        <li><a href="/tags.html">Tags</a></li>
                        <li><a href="/archive.html">Archive</a></li>
                        
                        <li><a href="/feed.xml" title="Subscribe via RSS feed">RSS</a></li>
                        <li><a href="/feeds/all.atom.xml" title="Subscribe via Atom feed">Atom</a></li>
                        
                        <li>
                            <button class="theme-toggle" type="button" aria-label="Toggle theme">
                                <span class="icon light-icon">‚òÄÔ∏è</span>
                                <span class="icon dark-icon">üåô</span>
                                <span class="theme-label">Theme</span>
                            </button>
                        </li>
                    </ul>
                </nav>
            </header>

            <main>
                
<article class="post">
    
    <nav class="post-navigation post-navigation-top">
        
        <a href="/2020/01/19/dnote-el.html" class="post-nav-link post-nav-prev" title="dnote.el - A wrapper for the dnote CLI">
            <span class="post-nav-label">‚Üê Previous Post</span>
        </a>
        
        
        <a href="/2020/06/14/my-journey-to-the-dark-side-is-complete.html" class="post-nav-link post-nav-next" title="My journey to the dark side is complete">
            <span class="post-nav-label">Next Post ‚Üí</span>
        </a>
        
    </nav>
    
    
    <header class="post-header">
        <h1>Some more ~/.emacs.d evolution</h1>
        
        <time datetime="2020-06-07T16:48:00+01:00">June 07, 2020 16:48:00 UTC+01:00</time>
        
        <div class="reading-time">4 min read</div>
        
        <div class="category">
            <a href="/category/emacs.html" class="category-link">Emacs</a>
        </div>
        
    </header>
    
    <div class="post-content">
        <p>When I started with this version of the blog on Hashnode<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>, my plan was to
try and write something at least once a week. I managed to do that as far as
January this year, give or take, but then things got a little busy, the
world got trickier, and... Well, <a href="https://en.wikipedia.org/wiki/COVID-19_pandemic" rel="noopener noreferrer" target="_blank">you don't need me to tell you about
that</a>. Anyway, I'm back to
write some more and, hopefully, try and keep up with writing. I feel it'll
do me good.</p>
<p>I have been busy since January. Work has, as far as possible, carried on as
normal. The only big difference being I'm back working from home. It's an
odd turn of events personally given that I'd worked from home for 21 years,
then (with some trepidation) <a href="/2017/12/12/on_to_something_new.html">went back to working in an
office</a>. Having got used to being in
an office and being around people, it took some adjusting to working alone
again.</p>
<p>So, on to the main point of this post... During that period I've spent a lot
more time at my machine than I would normally, and so it was inevitable that
I'd end up tinkering with <a href="https://github.com/davep/.emacs.d" rel="noopener noreferrer" target="_blank">my Emacs
configuration</a>. While it's true that
<a href="/2019/11/23/visual-evolution-of-emacs-config.html">there's hardly a week goes by where I don't tinker with some small
thing</a>, I try not to make
huge changes too often. Huge changes do happen though.</p>
<p>A handful of weeks back was another one of those times where I made a big
change.</p>
<p>After I <a href="/2016/05/26/starting_fresh_with_gnu_emacs.html">burnt my original <code>~/.emacs</code> file back in
2016</a> I've had an approach
where I've tried to make things as modular as possible, and as easy to clone
down to a new machine as possible. The design I came up with, <a href="/2017/07/13/more_revamping_of_my_emacs_config.html">especially
once I moved over to using
<code>use-package</code></a>, has
served me well. But there was always one thing that bothered me: the files
that handled the loading and configuration of packages were, in effect,
<a href="https://github.com/davep/.emacs.d/tree/728e74376bf5606d9ef2d297e36cc2d35e159d64/init.d/packages" rel="noopener noreferrer" target="_blank">still three large monolithic
files</a>.
While this was better than a single monolithic <code>~/.emacs</code>, it still didn't
feel quite right.</p>
<p>Giving it a bit of thought, I decided that what I really wanted was a single
directory in which I could drop lots of small <code>.el</code> files that would handle
the loading and configuration of all sorts of packages. While it didn't gain
anything concrete, the idea felt tidier. Tidy is good. Feeling like the code
smell is good, is good too.</p>
<p>First though I needed a way to load multiple files, ideally within a whole
directory hierarchy, without needing to know in advance what files would be
there. After a little bit of tinkering I settled on <a href="https://github.com/davep/.emacs.d/blob/c3d53152b1adc9ba5e43baddb986870b3244b113/init.d/init-packages.el#L42-L46" rel="noopener noreferrer" target="_blank">this bit of
code</a>
that revolves around the use of
<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Contents-of-Directories.html" rel="noopener noreferrer" target="_blank"><code>directory-files-recursively</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">source</span><span class="w"> </span><span class="p">(</span><span class="nf">expand-file-name</span><span class="w"> </span><span class="s">&quot;init.d/packages.d/&quot;</span><span class="w"> </span><span class="nv">user-emacs-directory</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="p">(</span><span class="nf">file-exists-p</span><span class="w"> </span><span class="nv">source</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">cl-loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="p">(</span><span class="nv">directory-files-recursively</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="p">(</span><span class="nb">rx</span><span class="w"> </span><span class="s">&quot;.el&quot;</span><span class="w"> </span><span class="nv">eol</span><span class="p">))</span>
<span class="w">             </span><span class="nb">do</span><span class="w"> </span><span class="p">(</span><span class="nf">load</span><span class="w"> </span><span class="p">(</span><span class="nv">file-name-sans-extension</span><span class="w"> </span><span class="nv">use</span><span class="p">)))))</span>
</code></pre></div>

<p>Simply put, this code finds every file in and below
<a href="https://github.com/davep/.emacs.d/tree/master/init.d/packages.d" rel="noopener noreferrer" target="_blank"><code>~/.emacs.d/init.d/packages.d/</code></a>
whose name ends in <code>.el</code> (note the use of a regular expression, using
<a href="/2019/12/01/being-phony-and-lispy-regular-expressions.html"><code>rx</code></a>
to create it), removes the extension from the name, and loads it with <code>load</code>
(dropping the extension means <code>load</code> can decide if it wants to load the
compiled version of the code, or the source, depending on what's available).</p>
<p>After writing that I could then start to populate
<code>~/.emacs.d/init.d/packages.d/</code> with lots of smaller files that handled the
loading of packages. In some cases there's a file just for one package, in
other cases there's a file that handles a logical grouping of packages
(where there are obvious direct dependencies, or where one package is
designed to extend the other, etc). For now I've decided to break things
down into three directories that map to the three monolithic files I had
before:</p>
<p><img alt="Screenshot 2020-06-07 at 16.36.28.png" src="/attachments/2020/06/07/Screenshot 2020-06-07 at 16.36.28.png" /></p>
<p>However, I'm not totally wedded to this design and I may change this as time
goes on.</p>
<p>While I've not spent any time properly testing it out, I've also not really
noticed any obvious impact on startup speed. However, this tends not to be a
real concern for me. I seldom <em>start</em> Emacs anyway. I always have it running
<a href="https://github.com/davep/e" rel="noopener noreferrer" target="_blank">and use <code>emacsclient</code> as my editor in most places so files open instantly
in the running version of Emacs</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Note from future me: we're now back over on <code>blog.davep.org</code> of
course.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    </div>
    
    
    <div class="tags">
        
        <a href="/tag/emacs.html" class="tag">Emacs</a>
        
        <a href="/tag/lisp.html" class="tag">Lisp</a>
        
        <a href="/tag/emacs-lisp.html" class="tag">Emacs Lisp</a>
        
    </div>
    
    
    
    <nav class="post-navigation post-navigation-bottom">
        
        <a href="/2020/01/19/dnote-el.html" class="post-nav-link post-nav-prev" title="dnote.el - A wrapper for the dnote CLI">
            <span class="post-nav-label">‚Üê Previous Post</span>
        </a>
        
        
        <a href="/2020/06/14/my-journey-to-the-dark-side-is-complete.html" class="post-nav-link post-nav-next" title="My journey to the dark side is complete">
            <span class="post-nav-label">Next Post ‚Üí</span>
        </a>
        
    </nav>
    
</article>

            </main>

            <footer>
                <p>Generated with <a href="https://github.com/davep/blogmore" target="_blank" rel="noopener noreferrer">Blogmore</a></p>
            </footer>
        </div>
    </div>
</body>
</html>